var MXI_DEBUG=!0;
(function(B,D){function N(e,g){for(var c,b=[],a=0;a<e.length;++a){if(!(c=F[e[a]]))a:{c=B;for(var k=e[a].split(/[.\/]/),d=0;d<k.length;++d){if(!c[k[d]]){c=void 0;break a}c=c[k[d]]}}if(!c)throw"module definition dependecy not found: "+e[a];b.push(c)}g.apply(null,b)}function q(e,g,c){if("string"!==typeof e)throw"invalid module definition, module id must be defined and be a string";if(g===D)throw"invalid module definition, dependencies must be specified";if(c===D)throw"invalid module definition, definition function must be specified";N(g,
function(){F[e]=c.apply(null,arguments)})}var F={};q("moxie/core/utils/Basic",[],function(){var e=function(a){return void 0===a?"undefined":null===a?"null":a.nodeType?"node":{}.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},g=function(a){c(arguments,function(k,d){0<d&&c(k,function(d,k){void 0!==d&&(e(a[k])===e(d)&&~b(e(d),["array","object"])?g(a[k],d):a[k]=d)})});return a},c=function(a,k){var d,b;if(a)if("number"===e(a.length))for(b=0,d=a.length;b<d&&!1!==k(a[b],b);b++);else if("object"===
e(a))for(d in a)if(a.hasOwnProperty(d)&&!1===k(a[d],d))break},b=function(a,k){if(k){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(k,a);for(var d=0,b=k.length;d<b;d++)if(k[d]===a)return d}return-1};return{guid:function(){var a=0;return function(k){var d=(new Date).getTime().toString(32),b;for(b=0;5>b;b++)d+=Math.floor(65535*Math.random()).toString(32);return(k||"o_")+d+(a++).toString(32)}}(),typeOf:e,extend:g,each:c,isEmptyObj:function(a){var b;if(!a||"object"!==e(a))return!0;for(b in a)return!1;
return!0},inSeries:function(a,b){function d(f){if("function"===e(a[f]))a[f](function(a){++f<h&&!a?d(f):b(a)})}var h=a.length;"function"!==e(b)&&(b=function(){});a&&a.length||b();d(0)},inParallel:function(a,b){var d=0,h=a.length,f=Array(h);c(a,function(a,c){a(function(a){if(a)return b(a);var m=[].slice.call(arguments);m.shift();f[c]=m;d++;d===h&&(f.unshift(null),b.apply(this,f))})})},inArray:b,arrayDiff:function(a,k){var d=[];"array"!==e(a)&&(a=[a]);"array"!==e(k)&&(k=[k]);for(var h in a)-1===b(a[h],
k)&&d.push(a[h]);return d.length?d:!1},arrayIntersect:function(a,k){var d=[];c(a,function(a){-1!==b(a,k)&&d.push(a)});return d.length?d:null},toArray:function(a){var b,d=[];for(b=0;b<a.length;b++)d[b]=a[b];return d},trim:function(a){return a?String.prototype.trim?String.prototype.trim.call(a):a.toString().replace(/^\s*/,"").replace(/\s*$/,""):a},sprintf:function(a){var b=[].slice.call(arguments,1);return a.replace(/%[a-z]/g,function(){var a=b.shift();return"undefined"!==e(a)?a:""})},parseSizeStr:function(a){if("string"!==
typeof a)return a;var b={t:1099511627776,g:1073741824,m:1048576,k:1024},d;a=/^([0-9\.]+)([tmgk]?)$/.exec(a.toLowerCase().replace(/[^0-9\.tmkg]/g,""));d=a[2];a=+a[1];b.hasOwnProperty(d)&&(a*=b[d]);return Math.floor(a)}}});q("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(e){var g=function(a){var d={has:function(a,d){return-1!==d.toLowerCase().indexOf(a.toLowerCase())},lowerize:function(a){return a.toLowerCase()}},b=function(){for(var d,b=0,f,c,h,m,l,e=arguments;b<e.length;b+=2){l=e[b];var p=
e[b+1];if("undefined"===typeof d)for(h in d={},p)f=p[h],"object"===typeof f?d[f[0]]=a:d[f]=a;for(f=c=0;f<l.length;f++)if(m=l[f].exec(this.getUA())){for(h=0;h<p.length;h++)l=m[++c],f=p[h],"object"===typeof f&&0<f.length?2==f.length?d[f[0]]="function"==typeof f[1]?f[1].call(this,l):f[1]:3==f.length?d[f[0]]="function"!==typeof f[1]||f[1].exec&&f[1].test?l?l.replace(f[1],f[2]):a:l?f[1].call(this,l,f[2]):a:4==f.length&&(d[f[0]]=l?f[3].call(this,l.replace(f[1],f[2])):a):d[f]=l?l:a;break}if(m)break}return d},
f=function(b,f){for(var c in f)if("object"===typeof f[c]&&0<f[c].length)for(var h=0;h<f[c].length;h++){if(d.has(f[c][h],b))return"?"===c?a:c}else if(d.has(f[c],b))return"?"===c?a:c;return b},c={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2E3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",RT:"ARM"},e=[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],["name","version"],[/\s(opr)\/([\w\.]+)/i],
[["name","Opera"],"version"],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],["name","version"],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[["name","IE"],"version"],[/(edge)\/((\d+)?[\w\.]+)/i],["name","version"],[/(yabrowser)\/([\w\.]+)/i],[["name",
"Yandex"],"version"],[/(comodo_dragon)\/([\w\.]+)/i],[["name",/_/g," "],"version"],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],["name","version"],[/(dolfin)\/([\w\.]+)/i],[["name","Dolphin"],"version"],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[["name","Chrome"],"version"],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],["version",["name","MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],["version",["name","Android Browser"]],
[/FBAV\/([\w\.]+);/i],["version",["name","Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],["version",["name","Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],["version","name"],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],["name",["version",f,{"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],["name","version"],[/(navigator|netscape)\/([\w\.-]+)/i],[["name",
"Netscape"],"version"],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],["name","version"]],l=[[/windows.+\sedge\/([\w\.]+)/i],["version",["name",
"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],["name","version"],[/rv\:([\w\.]+).*(gecko)/i],["version","name"]],g=[[/microsoft\s(windows)\s(vista|xp)/i],["name","version"],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],["name",["version",f,c]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[["name","Windows"],["version",
f,c]],[/\((bb)(10);/i],[["name","BlackBerry"],"version"],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],["name","version"],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[["name","Symbian"],"version"],[/\((series40);/i],["name"],[/mozilla.+\(mobile;.+gecko.+firefox/i],[["name","Firefox OS"],"version"],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,
/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],["name","version"],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[["name","Chromium OS"],"version"],[/(sunos)\s?([\w\.]+\d)*/i],[["name","Solaris"],"version"],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],["name","version"],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[["name",
"iOS"],["version",/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[["name","Mac OS"],["version",/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],["name","version"]];return function(a){var d=a||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:"");this.getBrowser=function(){return b.apply(this,
e)};this.getEngine=function(){return b.apply(this,l)};this.getOS=function(){return b.apply(this,g)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return d};this.setUA=function(a){d=a;return this};this.setUA(d)}}(),c=function(){var b={define_property:!1,create_canvas:function(){var a=document.createElement("canvas");return!(!a.getContext||!a.getContext("2d"))}(),return_response_type:function(a){try{if(-1!==
e.inArray(a,["","text","document"]))return!0;if(window.XMLHttpRequest){var b=new XMLHttpRequest;b.open("get","/");if("responseType"in b)return b.responseType=a,b.responseType!==a?!1:!0}}catch(f){}return!1},use_data_uri:function(){var a=new Image;a.onload=function(){b.use_data_uri=1===a.width&&1===a.height};setTimeout(function(){a.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return!1}(),use_data_uri_over32kb:function(){return b.use_data_uri&&("IE"!==
a.browser||9<=a.version)},use_data_uri_of:function(a){return b.use_data_uri&&33E3>a||b.use_data_uri_over32kb()},use_fileinput:function(){if(navigator.userAgent.match(/(Android (1.0|1.1|1.5|1.6|2.0|2.1))|(Windows Phone (OS 7|8.0))|(XBLWP)|(ZuneWP)|(w(eb)?OSBrowser)|(webOS)|(Kindle\/(1.0|2.0|2.5|3.0))/))return!1;var a=document.createElement("input");a.setAttribute("type","file");return!a.disabled}};return function(a){var c=[].slice.call(arguments);c.shift();return"function"===e.typeOf(b[a])?b[a].apply(this,
c):!!b[a]}}(),b=(new g).getResult(),a={can:c,uaParser:g,browser:b.browser.name,version:b.browser.version,os:b.os.name,osVersion:b.os.version,verComp:function(a,b,c){var f=0,m=0,e=0,l={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},f=function(a){a=(""+a).replace(/[_\-+]/g,".");a=a.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,".");return a.length?a.split("."):[-8]},g=function(a){return a?isNaN(a)?l[a]||-7:parseInt(a,10):0};a=f(a);b=f(b);m=Math.max(a.length,b.length);for(f=0;f<m;f++)if(a[f]!=
b[f])if(a[f]=g(a[f]),b[f]=g(b[f]),a[f]<b[f]){e=-1;break}else if(a[f]>b[f]){e=1;break}if(!c)return e;switch(c){case ">":case "gt":return 0<e;case ">=":case "ge":return 0<=e;case "<=":case "le":return 0>=e;case "==":case "=":case "eq":return 0===e;case "<>":case "!=":case "ne":return 0!==e;case "":case "<":case "lt":return 0>e;default:return null}},swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};a.OS=a.os;MXI_DEBUG&&
(a.debug={runtime:!0,events:!1},a.log=function(){var a=arguments[0];"string"===e.typeOf(a)&&(a=e.sprintf.apply(this,arguments));if(window&&window.console&&window.console.log)window.console.log(a);else if(document){var b=document.getElementById("moxie-console");b||(b=document.createElement("pre"),b.id="moxie-console",document.body.appendChild(b));e.inArray(e.typeOf(a),["object","array"]);b.appendChild(document.createTextNode(a+"\n"))}});return a});q("moxie/core/I18n",["moxie/core/utils/Basic"],function(e){var g=
{};return{addI18n:function(c){return e.extend(g,c)},translate:function(c){return g[c]||c},_:function(c){return this.translate(c)},sprintf:function(c){var b=[].slice.call(arguments,1);return c.replace(/%[a-z]/g,function(){var a=b.shift();return"undefined"!==e.typeOf(a)?a:""})}}});q("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(e,g){var c={mimes:{},extensions:{},addMimeType:function(b){b=b.split(/,/);var a,c,d;for(a=0;a<b.length;a+=2){d=b[a+1].split(/ /);for(c=0;c<d.length;c++)this.mimes[d[c]]=
b[a];this.extensions[b[a]]=d}},extList2mimes:function(b,a){var c,d,h,f,m=[];for(d=0;d<b.length;d++)for(c=b[d].extensions.split(/\s*,\s*/),h=0;h<c.length;h++){if("*"===c[h])return[];(f=this.mimes[c[h]])&&-1===e.inArray(f,m)&&m.push(f);if(a&&/^\w+$/.test(c[h]))m.push("."+c[h]);else if(!f)return[]}return m},mimes2exts:function(b){var a=this,c=[];e.each(b,function(b){if("*"===b)return c=[],!1;var h=b.match(/^(\w+)\/(\*|\w+)$/);h&&("*"===h[2]?e.each(a.extensions,function(b,d){(new RegExp("^"+h[1]+"/")).test(d)&&
[].push.apply(c,a.extensions[d])}):a.extensions[b]&&[].push.apply(c,a.extensions[b]))});return c},mimes2extList:function(b){var a=[],c=[];"string"===e.typeOf(b)&&(b=e.trim(b).split(/\s*,\s*/));c=this.mimes2exts(b);a.push({title:g.translate("Files"),extensions:c.length?c.join(","):"*"});a.mimes=b;return a},getFileExtension:function(b){return(b=b&&b.match(/\.([^.]+)$/))?b[1].toLowerCase():""},getFileMime:function(b){return this.mimes[this.getFileExtension(b)]||""}};c.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");
return c});q("moxie/core/utils/Dom",["moxie/core/utils/Env"],function(e){var g=function(c,b){return c.className?(new RegExp("(^|\\s+)"+b+"(\\s+|$)")).test(c.className):!1};return{get:function(c){return"string"!==typeof c?c:document.getElementById(c)},hasClass:g,addClass:function(c,b){g(c,b)||(c.className=c.className?c.className.replace(/\s+$/,"")+" "+b:b)},removeClass:function(c,b){c.className&&(c.className=c.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)"),function(a,b,d){return" "===b&&" "===
d?" ":""}))},getStyle:function(c,b){if(c.currentStyle)return c.currentStyle[b];if(window.getComputedStyle)return window.getComputedStyle(c,null)[b]},getPos:function(c,b){function a(a){var b,d=0;b=0;a&&(b=a.getBoundingClientRect(),a="CSS1Compat"===f.compatMode?f.documentElement:f.body,d=b.left+a.scrollLeft,b=b.top+a.scrollTop);return{x:d,y:b}}var k=0,d=0,h,f=document;b=b||f.body;if(c&&c.getBoundingClientRect&&"IE"===e.browser&&(!f.documentMode||8>f.documentMode))return k=a(c),d=a(b),{x:k.x-d.x,y:k.y-
d.y};for(h=c;h&&h!=b&&h.nodeType;)k+=h.offsetLeft||0,d+=h.offsetTop||0,h=h.offsetParent;for(h=c.parentNode;h&&h!=b&&h.nodeType;)k-=h.scrollLeft||0,d-=h.scrollTop||0,h=h.parentNode;return{x:k,y:d}},getSize:function(c){return{w:c.offsetWidth||c.clientWidth,h:c.offsetHeight||c.clientHeight}}}});q("moxie/core/Exceptions",["moxie/core/utils/Basic"],function(e){function g(c,b){for(var a in c)if(c[a]===b)return a;return null}return{RuntimeError:function(){function c(a){this.code=a;this.name=g(b,a);this.message=
this.name+": RuntimeError "+this.code}var b={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};e.extend(c,b);c.prototype=Error.prototype;return c}(),OperationNotAllowedException:function(){function c(b){this.code=b;this.name="OperationNotAllowedException"}e.extend(c,{NOT_ALLOWED_ERR:1});c.prototype=Error.prototype;return c}(),ImageError:function(){function c(a){this.code=a;this.name=g(b,a);this.message=this.name+": ImageError "+this.code}var b={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2,INVALID_META_ERR:3};e.extend(c,
b);c.prototype=Error.prototype;return c}(),FileException:function(){function c(a){this.code=a;this.name=g(b,a);this.message=this.name+": FileException "+this.code}var b={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};e.extend(c,b);c.prototype=Error.prototype;return c}(),DOMException:function(){function c(a){this.code=a;this.name=g(b,a);this.message=this.name+": DOMException "+this.code}var b={INDEX_SIZE_ERR:1,
DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};e.extend(c,b);
c.prototype=Error.prototype;return c}(),EventException:function(){function c(b){this.code=b;this.name="EventException"}e.extend(c,{UNSPECIFIED_EVENT_TYPE_ERR:0});c.prototype=Error.prototype;return c}()}});q("moxie/core/EventTarget",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic"],function(e,g,c){function b(){var a={};c.extend(this,{uid:null,init:function(){this.uid||(this.uid=c.guid("uid_"))},addEventListener:function(b,d,h,f){var m=this,e;this.hasOwnProperty("uid")||(this.uid=
c.guid("uid_"));b=c.trim(b);/\s/.test(b)?c.each(b.split(/\s+/),function(a){m.addEventListener(a,d,h,f)}):(b=b.toLowerCase(),h=parseInt(h,10)||0,e=a[this.uid]&&a[this.uid][b]||[],e.push({fn:d,priority:h,scope:f||this}),a[this.uid]||(a[this.uid]={}),a[this.uid][b]=e)},hasEventListener:function(b){return(b=b?a[this.uid]&&a[this.uid][b]:a[this.uid])?b:!1},removeEventListener:function(b,d){b=b.toLowerCase();var h=a[this.uid]&&a[this.uid][b],f;if(h){if(d)for(f=h.length-1;0<=f;f--){if(h[f].fn===d){h.splice(f,
1);break}}else h=[];h.length||(delete a[this.uid][b],c.isEmptyObj(a[this.uid])&&delete a[this.uid])}},removeAllEventListeners:function(){a[this.uid]&&delete a[this.uid]},dispatchEvent:function(b){var d,h,f,m={},p=!0;if("string"!==c.typeOf(b))if(h=b,"string"===c.typeOf(h.type))b=h.type,void 0!==h.total&&void 0!==h.loaded&&(m.total=h.total,m.loaded=h.loaded),m.async=h.async||!1;else throw new g.EventException(g.EventException.UNSPECIFIED_EVENT_TYPE_ERR);-1!==b.indexOf("::")?function(a){d=a[0];b=a[1]}(b.split("::")):
d=this.uid;b=b.toLowerCase();if(h=a[d]&&a[d][b]){h.sort(function(a,b){return b.priority-a.priority});f=[].slice.call(arguments);f.shift();m.type=b;f.unshift(m);MXI_DEBUG&&e.debug.events&&e.log("Event '%s' fired on %u",m.type,d);var l=[];c.each(h,function(a){f[0].target=a.scope;m.async?l.push(function(b){setTimeout(function(){b(!1===a.fn.apply(a.scope,f))},1)}):l.push(function(b){b(!1===a.fn.apply(a.scope,f))})});l.length&&c.inSeries(l,function(a){p=!a})}return p},bind:function(){this.addEventListener.apply(this,
arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},handleEventProps:function(a){var b=this;this.bind(a.join(" "),function(a){var b="on"+a.type.toLowerCase();"function"===c.typeOf(this[b])&&this[b].apply(this,arguments)});c.each(a,function(a){a="on"+a.toLowerCase(a);"undefined"===c.typeOf(b[a])&&(b[a]=null)})}})}b.instance=new b;return b});
q("moxie/runtime/Runtime",["moxie/core/utils/Env","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(e,g,c,b){function a(b,f,m,k,l){var r=this,n,x=g.guid(f+"_");l=l||"browser";b=b||{};d[x]=this;m=g.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,
select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},m);b.preferred_caps&&(l=a.getMode(k,b.preferred_caps,l));MXI_DEBUG&&e.debug.runtime&&e.log("\tdefault mode: %s",l);n=function(){var a={};return{exec:function(b,d,f,c){if(n[d]&&(a[b]||(a[b]={context:this,instance:new n[d]}),a[b].instance[f]))return a[b].instance[f].apply(this,c)},removeInstance:function(b){delete a[b]},removeAllInstances:function(){var b=
this;g.each(a,function(a,d){"function"===g.typeOf(a.instance.destroy)&&a.instance.destroy.call(a.context);b.removeInstance(d)})}}}();g.extend(this,{initialized:!1,uid:x,type:f,mode:a.getMode(k,b.required_caps,l),shimid:x+"_container",clients:0,options:b,can:function(b,d,f){f=f||m;"string"===g.typeOf(b)&&"undefined"===g.typeOf(d)&&(b=a.parseCaps(b));if("object"===g.typeOf(b)){for(var c in b)if(!this.can(c,b[c],f))return!1;return!0}return"function"===g.typeOf(f[b])?f[b].call(this,d):d===f[b]},getShimContainer:function(){var a,
b=c.get(this.shimid);b||(a=this.options.container?c.get(this.options.container):document.body,b=document.createElement("div"),b.id=this.shimid,b.className="moxie-shim moxie-shim-"+this.type,g.extend(b.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),a.appendChild(b));return b},getShim:function(){return n},shimExec:function(a,b){var d=[].slice.call(arguments,2);return r.getShim().exec.call(this,this.uid,a,b,d)},exec:function(a,b){var d=[].slice.call(arguments,
2);return r[a]&&r[a][b]?r[a][b].apply(this,d):r.shimExec.apply(this,arguments)},destroy:function(){if(r){var a=c.get(this.shimid);a&&a.parentNode.removeChild(a);n&&n.removeAllInstances();this.unbindAll();delete d[this.uid];x=r=n=this.uid=null}}});this.mode&&b.required_caps&&!this.can(b.required_caps)&&(this.mode=!1)}var k={},d={};a.order="html5,flash,silverlight,html4";a.getRuntime=function(a){return d[a]?d[a]:!1};a.addConstructor=function(a,d){d.prototype=b.instance;k[a]=d};a.getConstructor=function(a){return k[a]||
null};a.getInfo=function(b){var d=a.getRuntime(b);return d?{uid:d.uid,type:d.type,mode:d.mode,can:function(){return d.can.apply(d,arguments)}}:null};a.parseCaps=function(a){var b={};if("string"!==g.typeOf(a))return a||{};g.each(a.split(","),function(a){b[a]=!0});return b};a.can=function(b,d){var c;c=a.getConstructor(b);var e;return c?(c=new c({required_caps:d}),e=c.mode,c.destroy(),!!e):!1};a.thatCan=function(b,d){var c=(d||a.order).split(/\s*,\s*/),e;for(e in c)if(a.can(c[e],b))return c[e];return null};
a.getMode=function(a,b,d){var c=null;"undefined"===g.typeOf(d)&&(d="browser");if(b&&!g.isEmptyObj(a)){g.each(b,function(b,d){if(a.hasOwnProperty(d)){var f=a[d](b);"string"===typeof f&&(f=[f]);if(!c)c=f;else if(!(c=g.arrayIntersect(c,f)))return MXI_DEBUG&&e.debug.runtime&&e.log("\t\t%c: %v (conflicting mode requested: %s)",d,b,f),c=!1}MXI_DEBUG&&e.debug.runtime&&e.log("\t\t%c: %v (compatible modes: %s)",d,b,c)});if(c)return-1!==g.inArray(d,c)?d:c[0];if(!1===c)return!1}return d};a.capTrue=function(){return!0};
a.capFalse=function(){return!1};a.capTest=function(a){return function(){return!!a}};return a});q("moxie/runtime/RuntimeClient",["moxie/core/utils/Env","moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/Runtime"],function(e,g,c,b){return function(){var a;c.extend(this,{connectRuntime:function(k){function d(c){var f,l;c.length?(f=c.shift().toLowerCase(),(l=b.getConstructor(f))?(MXI_DEBUG&&e.debug.runtime&&(e.log("Trying runtime: %s",f),e.log(k)),a=new l(k),a.bind("Init",function(){a.initialized=
!0;MXI_DEBUG&&e.debug.runtime&&e.log("Runtime '%s' initialized",a.type);setTimeout(function(){a.clients++;h.trigger("RuntimeInit",a)},1)}),a.bind("Error",function(){MXI_DEBUG&&e.debug.runtime&&e.log("Runtime '%s' failed to initialize",a.type);a.destroy();d(c)}),MXI_DEBUG&&e.debug.runtime&&e.log("\tselected mode: %s",a.mode),a.mode?a.init():a.trigger("Error")):d(c)):(h.trigger("RuntimeError",new g.RuntimeError(g.RuntimeError.NOT_INIT_ERR)),a=null)}var h=this,f;"string"===c.typeOf(k)?f=k:"string"===
c.typeOf(k.ruid)&&(f=k.ruid);if(f){if(a=b.getRuntime(f))return a.clients++,a;throw new g.RuntimeError(g.RuntimeError.NOT_INIT_ERR);}d((k.runtime_order||b.order).split(/\s*,\s*/))},disconnectRuntime:function(){a&&0>=--a.clients&&a.destroy();a=null},getRuntime:function(){return a&&a.uid?a:a=null},exec:function(){return a?a.exec.apply(this,arguments):null}})}});q("moxie/file/FileInput","moxie/core/utils/Basic moxie/core/utils/Env moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/core/I18n moxie/runtime/Runtime moxie/runtime/RuntimeClient".split(" "),
function(e,g,c,b,a,k,d,h,f){function m(l){MXI_DEBUG&&g.log("Instantiating FileInput...");var m=this,k;-1!==e.inArray(e.typeOf(l),["string","node"])&&(l={browse_button:l});k=b.get(l.browse_button);if(!k)throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);k={accept:[{title:d.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:k.parentNode||document.body};l=e.extend({},k,l);"string"===typeof l.required_caps&&(l.required_caps=h.parseCaps(l.required_caps));"string"===
typeof l.accept&&(l.accept=c.mimes2extList(l.accept));k=b.get(l.container);k||(k=document.body);"static"===b.getStyle(k,"position")&&(k.style.position="relative");k=k=null;f.call(m);e.extend(m,{uid:e.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){m.bind("RuntimeInit",function(a,d){m.ruid=d.uid;m.shimid=d.shimid;m.bind("Ready",function(){m.trigger("Refresh")},999);m.bind("Refresh",function(){var a,c,f;c=b.get(l.browse_button);f=b.get(d.shimid);c&&(a=b.getPos(c,b.get(l.container)),c=
b.getSize(c),f&&e.extend(f.style,{top:a.y+"px",left:a.x+"px",width:c.w+"px",height:c.h+"px"}))});d.exec.call(m,"FileInput","init",l)});m.connectRuntime(e.extend({},l,{required_caps:{select_file:!0}}))},disable:function(a){var b=this.getRuntime();b&&b.exec.call(this,"FileInput","disable","undefined"===e.typeOf(a)?!0:a)},refresh:function(){m.trigger("Refresh")},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileInput","destroy"),this.disconnectRuntime());"array"===e.typeOf(this.files)&&
e.each(this.files,function(a){a.destroy()});this.files=null;this.unbindAll()}});this.handleEventProps(p)}var p="ready change cancel mouseenter mouseleave mousedown mouseup".split(" ");m.prototype=k.instance;return m});q("moxie/core/utils/Encode",[],function(){var e=function(c){return unescape(encodeURIComponent(c))},g=function(c){return decodeURIComponent(escape(c))};return{utf8_encode:e,utf8_decode:g,atob:function(c,b){if("function"===typeof window.atob)return b?g(window.atob(c)):window.atob(c);
var a,e,d,h,f,m=0,p=0;h="";var l=[];if(!c)return c;c+="";do a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(m++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(m++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(m++)),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c.charAt(m++)),d=a<<18|e<<12|h<<6|f,a=d>>16&255,e=d>>8&255,d&=255,64==h?l[p++]=String.fromCharCode(a):
64==f?l[p++]=String.fromCharCode(a,e):l[p++]=String.fromCharCode(a,e,d);while(m<c.length);h=l.join("");return b?g(h):h},btoa:function(c,b){b&&(c=e(c));if("function"===typeof window.btoa)return window.btoa(c);var a,k,d,h,f=0,m=0,g="",g=[];if(!c)return c;do a=c.charCodeAt(f++),k=c.charCodeAt(f++),d=c.charCodeAt(f++),h=a<<16|k<<8|d,a=h>>18&63,k=h>>12&63,d=h>>6&63,h&=63,g[m++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);while(f<c.length);g=g.join("");f=c.length%3;return(f?g.slice(0,f-3):g)+"===".slice(f||3)}}});q("moxie/file/Blob",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient"],function(e,g,c){function b(k,d){function h(d,c,h){var l=a[this.uid];if("string"!==e.typeOf(l)||!l.length)return null;c=new b(null,{type:h,size:c-d});
c.detach(l.substr(d,c.size));return c}c.call(this);k&&this.connectRuntime(k);d?"string"===e.typeOf(d)&&(d={data:d}):d={};e.extend(this,{uid:d.uid||e.guid("uid_"),ruid:k,size:d.size||0,type:d.type||"",slice:function(a,b,d){return this.isDetached()?h.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),a,b,d)},getSource:function(){return a[this.uid]?a[this.uid]:null},detach:function(b){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),
this.ruid=null);b=b||"";if("data:"==b.substr(0,5)){var d=b.indexOf(";base64,");this.type=b.substring(5,d);b=g.atob(b.substring(d+8))}this.size=b.length;a[this.uid]=b},isDetached:function(){return!this.ruid&&"string"===e.typeOf(a[this.uid])},destroy:function(){this.detach();delete a[this.uid]}});d.data?this.detach(d.data):a[this.uid]=d}var a={};return b});q("moxie/file/File",["moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/file/Blob"],function(e,g,c){function b(a,b){b||(b={});c.apply(this,
arguments);this.type||(this.type=g.getFileMime(b.name));var d;b.name?(d=b.name.replace(/\\/g,"/"),d=d.substr(d.lastIndexOf("/")+1)):this.type&&(d=this.type.split("/")[0],d=e.guid((""!==d?d:"file")+"_"),g.extensions[this.type]&&(d+="."+g.extensions[this.type][0]));e.extend(this,{name:d||e.guid("file_"),relativePath:"",lastModifiedDate:b.lastModifiedDate||(new Date).toLocaleString()})}b.prototype=c.prototype;return b});q("moxie/file/FileDrop","moxie/core/I18n moxie/core/utils/Dom moxie/core/Exceptions moxie/core/utils/Basic moxie/core/utils/Env moxie/file/File moxie/runtime/RuntimeClient moxie/core/EventTarget moxie/core/utils/Mime".split(" "),
function(e,g,c,b,a,k,d,h,f){function m(c){MXI_DEBUG&&a.log("Instantiating FileDrop...");var h=this,m;"string"===typeof c&&(c={drop_zone:c});m={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};c="object"===typeof c?b.extend({},m,c):m;c.container=g.get(c.drop_zone)||document.body;"static"===g.getStyle(c.container,"position")&&(c.container.style.position="relative");"string"===typeof c.accept&&(c.accept=f.mimes2extList(c.accept));d.call(h);b.extend(h,{uid:b.guid("uid_"),
ruid:null,files:null,init:function(){h.bind("RuntimeInit",function(a,b){h.ruid=b.uid;b.exec.call(h,"FileDrop","init",c);h.dispatchEvent("ready")});h.connectRuntime(c)},destroy:function(){var a=this.getRuntime();a&&(a.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null;this.unbindAll()}});this.handleEventProps(p)}var p=["ready","dragenter","dragleave","drop","error"];m.prototype=h.instance;return m});q("moxie/file/FileReader","moxie/core/utils/Basic moxie/core/utils/Encode moxie/core/Exceptions moxie/core/EventTarget moxie/file/Blob moxie/runtime/RuntimeClient".split(" "),
function(e,g,c,b,a,k){function d(){function b(f,h){this.trigger("loadstart");if(this.readyState===d.LOADING)this.trigger("error",new c.DOMException(c.DOMException.INVALID_STATE_ERR)),this.trigger("loadend");else if(h instanceof a)if(this.result=null,this.readyState=d.LOADING,h.isDetached()){var e=h.getSource();switch(f){case "readAsText":case "readAsBinaryString":this.result=e;break;case "readAsDataURL":this.result="data:"+h.type+";base64,"+g.btoa(e)}this.readyState=d.DONE;this.trigger("load");this.trigger("loadend")}else this.connectRuntime(h.ruid),
this.exec("FileReader","read",f,h);else this.trigger("error",new c.DOMException(c.DOMException.NOT_FOUND_ERR)),this.trigger("loadend")}k.call(this);e.extend(this,{uid:e.guid("uid_"),readyState:d.EMPTY,result:null,error:null,readAsBinaryString:function(a){b.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){b.call(this,"readAsDataURL",a)},readAsText:function(a){b.call(this,"readAsText",a)},abort:function(){this.result=null;-1===e.inArray(this.readyState,[d.EMPTY,d.DONE])&&(this.readyState===
d.LOADING&&(this.readyState=d.DONE),this.exec("FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();this.exec("FileReader","destroy");this.disconnectRuntime();this.unbindAll()}});this.handleEventProps(h);this.bind("Error",function(a,b){this.readyState=d.DONE;this.error=b},999);this.bind("Load",function(a){this.readyState=d.DONE},999)}var h="loadstart progress load abort error loadend".split(" ");d.EMPTY=0;d.LOADING=1;d.DONE=2;d.prototype=b.instance;
return d});q("moxie/core/utils/Url",[],function(){var e=function(g,c){for(var b="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" "),a=b.length,k={http:80,https:443},d={},h=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(g||"");a--;)h[a]&&(d[b[a]]=h[a]);d.scheme||(c&&"string"!==typeof c||(c=e(c||document.location.href)),d.scheme=
c.scheme,d.host=c.host,d.port=c.port,b="",/^[^\/]/.test(d.path)&&(b=c.path,b=/\/[^\/]*\.[^\/]*$/.test(b)?b.replace(/\/[^\/]+$/,"/"):b.replace(/\/?$/,"/")),d.path=b+(d.path||""));d.port||(d.port=k[d.scheme]||80);d.port=parseInt(d.port,10);d.path||(d.path="/");delete d.source;return d};return{parseUrl:e,resolveUrl:function(g){g="object"===typeof g?g:e(g);return g.scheme+"://"+g.host+(g.port!=={http:80,https:443}[g.scheme]?":"+g.port:"")+g.path+(g.query?g.query:"")},hasSameOrigin:function(g){function c(b){return[b.scheme,
b.host,b.port].join("/")}"string"===typeof g&&(g=e(g));return c(e())===c(g)}}});q("moxie/runtime/RuntimeTarget",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(e,g,c){function b(){this.uid=e.guid("uid_");g.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}b.prototype=c.instance;return b});q("moxie/file/FileReaderSync",["moxie/core/utils/Basic","moxie/runtime/RuntimeClient","moxie/core/utils/Encode"],function(e,g,c){return function(){function b(a,
b){if(b.isDetached()){var d=b.getSource();switch(a){case "readAsBinaryString":return d;case "readAsDataURL":return"data:"+b.type+";base64,"+c.btoa(d);case "readAsText":for(var h="",f=0,e=d.length;f<e;f++)h+=String.fromCharCode(d[f]);return h}}else return d=this.connectRuntime(b.ruid).exec.call(this,"FileReaderSync","read",a,b),this.disconnectRuntime(),d}g.call(this);e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(a){return b.call(this,"readAsBinaryString",a)},readAsDataURL:function(a){return b.call(this,
"readAsDataURL",a)},readAsText:function(a){return b.call(this,"readAsText",a)}})}});q("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(e,g,c){return function(){var b,a=[];g.extend(this,{append:function(e,d){var h=this,f=g.typeOf(d);d instanceof c?b={name:e,value:d}:"array"===f?(e+="[]",g.each(d,function(a){h.append(e,a)})):"object"===f?g.each(d,function(a,b){h.append(e+"["+b+"]",a)}):"null"===f||"undefined"===f||"number"===f&&isNaN(d)?h.append(e,"false"):
a.push({name:e,value:d.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return b&&b.value||null},getBlobName:function(){return b&&b.name||null},each:function(c){g.each(a,function(a){c(a.value,a.name)});b&&c(b.value,b.name)},destroy:function(){b=null;a=[]}})}});q("moxie/xhr/XMLHttpRequest","moxie/core/utils/Basic moxie/core/Exceptions moxie/core/EventTarget moxie/core/utils/Encode moxie/core/utils/Url moxie/runtime/Runtime moxie/runtime/RuntimeTarget moxie/file/Blob moxie/file/FileReaderSync moxie/xhr/FormData moxie/core/utils/Env moxie/core/utils/Mime".split(" "),
function(e,g,c,b,a,k,d,h,f,m,p,l){function r(){this.uid=e.guid("uid_")}function n(){function c(a,b){if(u.hasOwnProperty(a)){if(1===arguments.length)return p.can("define_property")?u[a]:z[a];p.can("define_property")?u[a]=b:z[a]=b}}function f(a){function b(){A&&(A.destroy(),A=null);l.dispatchEvent("loadend");l=null}function h(d){A.bind("LoadStart",function(a){c("readyState",n.LOADING);l.dispatchEvent("readystatechange");l.dispatchEvent(a);D&&l.upload.dispatchEvent(a)});A.bind("Progress",function(a){c("readyState")!==
n.LOADING&&(c("readyState",n.LOADING),l.dispatchEvent("readystatechange"));l.dispatchEvent(a)});A.bind("UploadProgress",function(a){D&&l.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:a.total,loaded:a.loaded})});A.bind("Load",function(a){c("readyState",n.DONE);c("status",Number(d.exec.call(A,"XMLHttpRequest","getStatus")||0));c("statusText",x[c("status")]||"");c("response",d.exec.call(A,"XMLHttpRequest","getResponse",c("responseType")));~e.inArray(c("responseType"),["text",""])?c("responseText",
c("response")):"document"===c("responseType")&&c("responseXML",c("response"));F=d.exec.call(A,"XMLHttpRequest","getAllResponseHeaders");l.dispatchEvent("readystatechange");0<c("status")?(D&&l.upload.dispatchEvent(a),l.dispatchEvent(a)):(I=!0,l.dispatchEvent("error"));b()});A.bind("Abort",function(a){l.dispatchEvent(a);b()});A.bind("Error",function(a){I=!0;c("readyState",n.DONE);l.dispatchEvent("readystatechange");K=!0;l.dispatchEvent(a);b()});d.exec.call(A,"XMLHttpRequest","send",{url:C,method:G,
async:y,user:O,password:P,headers:q,mimeType:L,encoding:Q,responseType:l.responseType,withCredentials:l.withCredentials,options:E},a)}var l=this;(new Date).getTime();A=new d;"string"===typeof E.required_caps&&(E.required_caps=k.parseCaps(E.required_caps));E.required_caps=e.extend({},E.required_caps,{return_response_type:l.responseType});a instanceof m&&(E.required_caps.send_multipart=!0);e.isEmptyObj(q)||(E.required_caps.send_custom_headers=!0);B||(E.required_caps.do_cors=!0);E.ruid?h(A.connectRuntime(E)):
(A.bind("RuntimeInit",function(a,b){h(b)}),A.bind("RuntimeError",function(a,b){l.dispatchEvent("RuntimeError",b)}),A.connectRuntime(E))}var z=this,u={timeout:0,readyState:n.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},y=!0,C,G,q={},O,P,Q=null,L=null,M=!1,J=!1,D=!1,K=!1,I=!1,B=!1,E={},A,F="",H;e.extend(this,u,{uid:e.guid("uid_"),upload:new r,open:function(d,f,h,l,m){if(!d||!f)throw new g.DOMException(g.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(d)||
b.utf8_encode(d)!==d)throw new g.DOMException(g.DOMException.SYNTAX_ERR);~e.inArray(d.toUpperCase(),"CONNECT DELETE GET HEAD OPTIONS POST PUT TRACE TRACK".split(" "))&&(G=d.toUpperCase());if(~e.inArray(G,["CONNECT","TRACE","TRACK"]))throw new g.DOMException(g.DOMException.SECURITY_ERR);f=b.utf8_encode(f);d=a.parseUrl(f);B=a.hasSameOrigin(d);C=a.resolveUrl(f);if((l||m)&&!B)throw new g.DOMException(g.DOMException.INVALID_ACCESS_ERR);O=l||d.user;P=m||d.pass;y=h||!0;if(!1===y&&(c("timeout")||c("withCredentials")||
""!==c("responseType")))throw new g.DOMException(g.DOMException.INVALID_ACCESS_ERR);M=!y;J=!1;q={};c("responseText","");c("responseXML",null);c("response",null);c("status",0);c("statusText","");c("readyState",n.OPENED);this.dispatchEvent("readystatechange")},setRequestHeader:function(a,d){if(c("readyState")!==n.OPENED||J)throw new g.DOMException(g.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(a)||b.utf8_encode(a)!==a)throw new g.DOMException(g.DOMException.SYNTAX_ERR);a=e.trim(a).toLowerCase();
if(~e.inArray(a,"accept-charset accept-encoding access-control-request-headers access-control-request-method connection content-length cookie cookie2 content-transfer-encoding date expect host keep-alive origin referer te trailer transfer-encoding upgrade user-agent via".split(" "))||/^(proxy\-|sec\-)/.test(a))return!1;q[a]=q[a]?q[a]+(", "+d):d;return!0},getAllResponseHeaders:function(){return F||""},getResponseHeader:function(a){a=a.toLowerCase();return I||~e.inArray(a,["set-cookie","set-cookie2"])?
null:F&&""!==F&&(H||(H={},e.each(F.split(/\r\n/),function(a){a=a.split(/:\s+/);2===a.length&&(a[0]=e.trim(a[0]),H[a[0].toLowerCase()]={header:a[0],value:e.trim(a[1])})})),H.hasOwnProperty(a))?H[a].header+": "+H[a].value:null},overrideMimeType:function(a){var b;if(~e.inArray(c("readyState"),[n.LOADING,n.DONE]))throw new g.DOMException(g.DOMException.INVALID_STATE_ERR);a=e.trim(a.toLowerCase());/;/.test(a)&&(b=a.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(a=b[1]);if(!l.mimes[a])throw new g.DOMException(g.DOMException.SYNTAX_ERR);
},send:function(a,c){E="string"===e.typeOf(c)?{ruid:c}:c?c:{};if(this.readyState!==n.OPENED||J)throw new g.DOMException(g.DOMException.INVALID_STATE_ERR);if(a instanceof h)E.ruid=a.ruid,L=a.type||"application/octet-stream";else if(a instanceof m){if(a.hasBlob()){var d=a.getBlob();E.ruid=d.ruid;L=d.type||"application/octet-stream"}}else"string"===typeof a&&(Q="UTF-8",L="text/plain;charset=UTF-8",a=b.utf8_encode(a));this.withCredentials||(this.withCredentials=E.required_caps&&E.required_caps.send_browser_cookies&&
!B);D=!M&&this.upload.hasEventListener();I=!1;K=!a;M||(J=!0);f.call(this,a)},abort:function(){I=!0;M=!1;if(~e.inArray(c("readyState"),[n.UNSENT,n.OPENED,n.DONE]))c("readyState",n.UNSENT);else{c("readyState",n.DONE);J=!1;if(A)A.getRuntime().exec.call(A,"XMLHttpRequest","abort",K);else throw new g.DOMException(g.DOMException.INVALID_STATE_ERR);K=!0}},destroy:function(){A&&("function"===e.typeOf(A.destroy)&&A.destroy(),A=null);this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}});
this.handleEventProps(t.concat(["readystatechange"]));this.upload.handleEventProps(t)}var x={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",
402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",
502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};r.prototype=c.instance;var t="loadstart progress abort error load timeout loadend".split(" ");n.UNSENT=0;n.OPENED=1;n.HEADERS_RECEIVED=2;n.LOADING=3;n.DONE=4;n.prototype=c.instance;return n});q("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],
function(e,g,c,b){function a(){function b(c,h){var g=this;f=h;g.bind("TransportingProgress",function(b){l=b.loaded;l<p&&-1===e.inArray(g.state,[a.IDLE,a.DONE])&&d.call(g)},999);g.bind("TransportingComplete",function(){l=p;g.state=a.DONE;m=null;g.result=f.exec.call(g,"Transporter","getAsBlob",c||"")},999);g.state=a.BUSY;g.trigger("TransportingStarted");d.call(g)}function d(){var a;a=p-l;r>a&&(r=a);a=g.btoa(m.substr(l,r));f.exec.call(this,"Transporter","receive",a,p)}var h,f,m,p,l,r;c.call(this);e.extend(this,
{uid:e.guid("uid_"),state:a.IDLE,result:null,transport:function(a,c,d){var f=this;d=e.extend({chunk_size:204798},d);if(h=d.chunk_size%3)d.chunk_size+=3-h;r=d.chunk_size;p=l=0;m=this.result=null;m=a;p=a.length;if("string"===e.typeOf(d)||d.ruid)b.call(f,c,this.connectRuntime(d));else{var g=function(a,d){f.unbind("RuntimeInit",g);b.call(f,c,d)};this.bind("RuntimeInit",g);this.connectRuntime(d)}},abort:function(){this.state=a.IDLE;f&&(f.exec.call(this,"Transporter","clear"),this.trigger("TransportingAborted"));
p=l=0;m=this.result=null},destroy:function(){this.unbindAll();f=null;this.disconnectRuntime();p=l=0;m=this.result=null}})}a.IDLE=0;a.BUSY=1;a.DONE=2;a.prototype=b.instance;return a});q("moxie/image/Image","moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/Exceptions moxie/file/FileReaderSync moxie/xhr/XMLHttpRequest moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/runtime/Transporter moxie/core/utils/Env moxie/core/EventTarget moxie/file/Blob moxie/file/File moxie/core/utils/Encode".split(" "),
function(e,g,c,b,a,k,d,h,f,m,p,l,r){function n(){function b(a){var d=e.typeOf(a);try{if(a instanceof n){if(!a.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);m.apply(this,arguments)}else if(a instanceof p){if(!~e.inArray(a.type,["image/jpeg","image/png"]))throw new c.ImageError(c.ImageError.WRONG_FORMAT);w.apply(this,arguments)}else if(-1!==e.inArray(d,["blob","file"]))b.call(this,new l(null,a),arguments[1]);else if("string"===d)"data:"===a.substr(0,5)?b.call(this,new p(null,{data:a}),
arguments[1]):z.apply(this,arguments);else if("node"===d&&"img"===a.nodeName.toLowerCase())b.call(this,a.src,arguments[1]);else throw new c.DOMException(c.DOMException.TYPE_MISMATCH_ERR);}catch(f){this.trigger("error",f.code)}}function m(a,b){var c=this.connectRuntime(a.ruid);this.ruid=c.uid;c.exec.call(this,"Image","loadFromImage",a,"undefined"===e.typeOf(b)?!0:b)}function w(a,b){function c(b){d.ruid=b.uid;b.exec.call(d,"Image","loadFromBlob",a)}var d=this;d.name=a.name||"";a.isDetached()?(this.bind("RuntimeInit",
function(a,b){c(b)}),b&&"string"===typeof b.required_caps&&(b.required_caps=k.parseCaps(b.required_caps)),this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},b))):c(this.connectRuntime(a.ruid))}function z(b,c){var d=this,f;f=new a;f.open("get",b);f.responseType="blob";f.onprogress=function(a){d.trigger(a)};f.onload=function(){w.call(d,f.response,!0)};f.onerror=function(a){d.trigger(a)};f.onloadend=function(){f.destroy()};f.bind("RuntimeError",function(a,b){d.trigger("RuntimeError",
b)});f.send(null,c)}d.call(this);e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){b.apply(this,arguments)},downsize:function(a,b,d,f){var h={width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90,crop:!1,preserveHeaders:!0,resample:!1};a="object"===typeof a?e.extend(h,a):e.extend(h,{width:a,height:b,crop:d,preserveHeaders:f});try{if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);
if(this.width>n.MAX_RESIZE_WIDTH||this.height>n.MAX_RESIZE_HEIGHT)throw new c.ImageError(c.ImageError.MAX_RESOLUTION_ERR);this.exec("Image","downsize",a.width,a.height,a.crop,a.preserveHeaders)}catch(l){this.trigger("error",l.code)}},crop:function(a,b,c){this.downsize(a,b,!0,c)},getAsCanvas:function(){if(!f.can("create_canvas"))throw new c.RuntimeError(c.RuntimeError.NOT_SUPPORTED_ERR);return this.connectRuntime(this.ruid).exec.call(this,"Image","getAsCanvas")},getAsBlob:function(a,b){if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);
return this.exec("Image","getAsBlob",a||"image/jpeg",b||90)},getAsDataURL:function(a,b){if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);return this.exec("Image","getAsDataURL",a||"image/jpeg",b||90)},getAsBinaryString:function(a,b){var c=this.getAsDataURL(a,b);return r.atob(c.substring(c.indexOf("base64,")+7))},embed:function(a,b){function d(b,g){var k=this;if(f.can("create_canvas")){var p=k.getAsCanvas();if(p){a.appendChild(p);p=null;k.destroy();l.trigger("embedded");return}}p=
k.getAsDataURL(b,g);if(!p)throw new c.ImageError(c.ImageError.WRONG_FORMAT);if(f.can("use_data_uri_of",p.length))a.innerHTML='<img src="'+p+'" width="'+k.width+'" height="'+k.height+'" />',k.destroy(),l.trigger("embedded");else{var n=new h;n.bind("TransportingComplete",function(){m=l.connectRuntime(this.result.ruid);l.bind("Embedded",function(){e.extend(m.getShimContainer().style,{top:"0px",left:"0px",width:k.width+"px",height:k.height+"px"});m=null},999);m.exec.call(l,"ImageView","display",this.result.uid,
width,height);k.destroy()});n.transport(r.atob(p.substring(p.indexOf("base64,")+7)),b,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:a})}}var l=this,m;b=e.extend({width:this.width,height:this.height,type:this.type||"image/jpeg",quality:90},b||{});try{if(!(a=g.get(a)))throw new c.DOMException(c.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new c.DOMException(c.DOMException.INVALID_STATE_ERR);var k=new n;k.bind("Resize",function(){d.call(this,b.type,b.quality)});
k.bind("Load",function(){k.downsize(b)});this.meta.thumb&&this.meta.thumb.width>=b.width&&this.meta.thumb.height>=b.height?k.load(this.meta.thumb.data):k.clone(this,!1);return k}catch(p){this.trigger("error",p.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.unbindAll()}});this.handleEventProps(x);this.bind("Load Resize",function(){var a=void 0,a=this.exec("Image","getInfo");this.size=a.size;this.width=a.width;this.height=a.height;
this.type=a.type;this.meta=a.meta;""===this.name&&(this.name=a.name)},999)}var x=["progress","load","error","resize","embedded"];n.MAX_RESIZE_WIDTH=8192;n.MAX_RESIZE_HEIGHT=8192;n.prototype=m.instance;return n});q("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(e,g,c,b){var a={};c.addConstructor("html5",function(g,d,h){var f=this,m=c.capTest,p=c.capTrue;h=e.extend({access_binary:m(window.FileReader||window.File&&
window.File.getAsDataURL),access_image_binary:function(){return f.can("access_binary")&&!!a.Image},display_media:m(b.can("create_canvas")||b.can("use_data_uri_over32kb")),do_cors:m(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:m(function(){var a=document.createElement("div");return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&("IE"!==b.browser||b.verComp(b.version,9,">"))}()),filter_by_extension:m("Chrome"===b.browser&&b.verComp(b.version,28,">=")||"IE"===b.browser&&
b.verComp(b.version,10,">=")||"Safari"===b.browser&&b.verComp(b.version,7,">=")),return_response_headers:p,return_response_type:function(a){return"json"===a&&window.JSON?!0:b.can("return_response_type",a)},return_status_code:p,report_upload_progress:m(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return f.can("access_binary")&&b.can("create_canvas")},select_file:function(){return b.can("use_fileinput")&&window.File},select_folder:function(){return f.can("select_file")&&
"Chrome"===b.browser&&b.verComp(b.version,21,">=")},select_multiple:function(){return f.can("select_file")&&!("Safari"===b.browser&&"Windows"===b.os)&&!("iOS"===b.os&&b.verComp(b.osVersion,"7.0.0",">")&&b.verComp(b.osVersion,"8.0.0","<"))},send_binary_string:m(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:m(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||
f.can("send_binary_string")},slice_blob:m(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return f.can("slice_blob")&&f.can("send_multipart")},summon_file_dialog:function(){return f.can("select_file")&&("Firefox"===b.browser&&b.verComp(b.version,4,">=")||"Opera"===b.browser&&b.verComp(b.version,12,">=")||"IE"===b.browser&&b.verComp(b.version,10,">=")||!!~e.inArray(b.browser,["Chrome","Safari"]))},upload_filesize:p},h);c.call(this,
g,d||"html5",h);e.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(f);a=f=null}}(this.destroy)});e.extend(this.getShim(),a)});return a});q("moxie/core/utils/Events",["moxie/core/utils/Basic"],function(e){function g(){this.returnValue=!1}function c(){this.cancelBubble=!0}var b={},a="moxie_"+e.guid(),k=function(c,h,f){var m;h=h.toLowerCase();if(c[a]&&b[c[a]]&&b[c[a]][h]){m=b[c[a]][h];for(var g=m.length-1;0<=g;g--)if(m[g].orig===f||m[g].key===f)if(c.removeEventListener?
c.removeEventListener(h,m[g].func,!1):c.detachEvent&&c.detachEvent("on"+h,m[g].func),m[g].orig=null,m[g].func=null,m.splice(g,1),void 0!==f)break;m.length||delete b[c[a]][h];if(e.isEmptyObj(b[c[a]])){delete b[c[a]];try{delete c[a]}catch(l){c[a]=void 0}}}};return{addEvent:function(d,h,f,m){var k;h=h.toLowerCase();d.addEventListener?(k=f,d.addEventListener(h,k,!1)):d.attachEvent&&(k=function(){var a=window.event;a.target||(a.target=a.srcElement);a.preventDefault=g;a.stopPropagation=c;f(a)},d.attachEvent("on"+
h,k));d[a]||(d[a]=e.guid());b.hasOwnProperty(d[a])||(b[d[a]]={});d=b[d[a]];d.hasOwnProperty(h)||(d[h]=[]);d[h].push({func:k,orig:f,key:m})},removeEvent:k,removeAllEvents:function(c,h){c&&c[a]&&e.each(b[c[a]],function(a,b){k(c,b,h)})}}});q("moxie/runtime/html5/file/FileInput","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(e,g,c,b,a,k,d){return e.FileInput=function(){var h;
c.extend(this,{init:function(f){var e=this,p=e.getRuntime(),l,r,n;h=f;f=h.accept.mimes||k.extList2mimes(h.accept,p.can("filter_by_extension"));l=p.getShimContainer();l.innerHTML='<input id="'+p.uid+'" type="file" style="font-size:999px;opacity:0;"'+(h.multiple&&p.can("select_multiple")?"multiple":"")+(h.directory&&p.can("select_folder")?"webkitdirectory directory":"")+(f?' accept="'+f.join(",")+'"':"")+" />";f=b.get(p.uid);c.extend(f.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});
r=b.get(h.browse_button);p.can("summon_file_dialog")&&("static"===b.getStyle(r,"position")&&(r.style.position="relative"),n=parseInt(b.getStyle(r,"z-index"),10)||1,r.style.zIndex=n,l.style.zIndex=n-1,a.addEvent(r,"click",function(a){var c=b.get(p.uid);c&&!c.disabled&&c.click();a.preventDefault()},e.uid));l=p.can("summon_file_dialog")?r:l;a.addEvent(l,"mouseover",function(){e.trigger("mouseenter")},e.uid);a.addEvent(l,"mouseout",function(){e.trigger("mouseleave")},e.uid);a.addEvent(l,"mousedown",function(){e.trigger("mousedown")},
e.uid);a.addEvent(b.get(h.container),"mouseup",function(){e.trigger("mouseup")},e.uid);f.onchange=function t(a){e.files=[];c.each(this.files,function(a){var b="";if(h.directory&&"."==a.name)return!0;a.webkitRelativePath&&(b="/"+a.webkitRelativePath.replace(/^\//,""));a=new g(p.uid,a);a.relativePath=b;e.files.push(a)});"IE"!==d.browser&&"IEMobile"!==d.browser?this.value="":(a=this.cloneNode(!0),this.parentNode.replaceChild(a,this),a.onchange=t);e.files.length&&e.trigger("change")};e.trigger({type:"ready",
async:!0});l=null},disable:function(a){var c=this.getRuntime();if(c=b.get(c.uid))c.disabled=!!a},destroy:function(){var c=this.getRuntime(),d=c.getShim(),c=c.getShimContainer();a.removeAllEvents(c,this.uid);a.removeAllEvents(h&&b.get(h.container),this.uid);a.removeAllEvents(h&&b.get(h.browse_button),this.uid);c&&(c.innerHTML="");d.removeInstance(this.uid);h=null}})}});q("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(e,g){return e.Blob=function(){function c(b,
a,c){var d;if(window.File.prototype.slice)try{return b.slice(),b.slice(a,c)}catch(e){return b.slice(a,c-a)}else return(d=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?d.call(b,a,c):null}this.slice=function(){return new g(this.getRuntime().uid,c.apply(this,arguments))}}});q("moxie/runtime/html5/file/FileDrop","moxie/runtime/html5/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime".split(" "),function(e,g,c,b,a,k){return e.FileDrop=
function(){function d(a){if(!a.dataTransfer||!a.dataTransfer.types)return!1;a=c.toArray(a.dataTransfer.types||[]);return-1!==c.inArray("Files",a)||-1!==c.inArray("public.file-url",a)||-1!==c.inArray("application/x-moz-file",a)}function e(a,b){var d;x.length?(d=k.getFileExtension(a.name),d=!d||-1!==c.inArray(d,x)):d=!0;d&&(d=new g(v,a),d.relativePath=b||"",n.push(d))}function f(a){for(var b=[],d=0;d<a.length;d++)[].push.apply(b,a[d].extensions.split(/\s*,\s*/));return-1===c.inArray("*",b)?b:[]}function m(a,
b){var d=[];c.each(a,function(a){var b=a.webkitGetAsEntry();b&&(b.isFile?e(a.getAsFile(),b.fullPath):d.push(b))});d.length?p(d,b):b()}function p(a,b){var d=[];c.each(a,function(a){d.push(function(b){l(a,b)})});c.inSeries(d,function(){b()})}function l(a,b){a.isFile?a.file(function(c){e(c,a.fullPath);b()},function(){b()}):a.isDirectory?r(a,b):b()}function r(a,b){function c(a){f.readEntries(function(b){b.length?([].push.apply(d,b),c(a)):a()},a)}var d=[],f=a.createReader();c(function(){p(d,b)})}var n=
[],x=[],t,v;c.extend(this,{init:function(b){var l=this;t=b;v=l.ruid;x=f(t.accept);b=t.container;a.addEvent(b,"dragover",function(a){d(a)&&(a.preventDefault(),a.dataTransfer.dropEffect="copy")},l.uid);a.addEvent(b,"drop",function(a){d(a)&&(a.preventDefault(),n=[],a.dataTransfer.items&&a.dataTransfer.items[0].webkitGetAsEntry?m(a.dataTransfer.items,function(){l.files=n;l.trigger("drop")}):(c.each(a.dataTransfer.files,function(a){e(a)}),l.files=n,l.trigger("drop")))},l.uid);a.addEvent(b,"dragenter",
function(a){l.trigger("dragenter")},l.uid);a.addEvent(b,"dragleave",function(a){l.trigger("dragleave")},l.uid)},destroy:function(){a.removeAllEvents(t&&b.get(t.container),this.uid);v=n=x=t=null}})}});q("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(e,g,c){return e.FileReader=function(){var b,a=!1;c.extend(this,{read:function(e,d){var h=this;h.result="";b=new window.FileReader;b.addEventListener("progress",function(a){h.trigger(a)});
b.addEventListener("load",function(c){var d;a?(d=b.result,d=g.atob(d.substring(d.indexOf("base64,")+7))):d=b.result;h.result=d;h.trigger(c)});b.addEventListener("error",function(a){h.trigger(a,b.error)});b.addEventListener("loadend",function(a){b=null;h.trigger(a)});"function"===c.typeOf(b[e])?(a=!1,b[e](d.getSource())):"readAsBinaryString"===e&&(a=!0,b.readAsDataURL(d.getSource()))},abort:function(){b&&b.abort()},destroy:function(){b=null}})}});q("moxie/runtime/html5/xhr/XMLHttpRequest","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/utils/Mime moxie/core/utils/Url moxie/file/File moxie/file/Blob moxie/xhr/FormData moxie/core/Exceptions moxie/core/utils/Env".split(" "),
function(e,g,c,b,a,k,d,h,f){return e.XMLHttpRequest=function(){function e(a,b){var c=this,d,f;d=b.getBlob().getSource();f=new window.FileReader;f.onload=function(){b.append(b.getBlobName(),new k(null,{type:d.type,data:f.result}));r.send.call(c,a,b)};f.readAsBinaryString(d)}function p(){if(!window.XMLHttpRequest||"IE"===f.browser&&f.verComp(f.version,8,"<")){var a;a:{for(var b=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],c=0;c<b.length;c++)try{a=new ActiveXObject(b[c]);break a}catch(d){}a=void 0}return a}return new window.XMLHttpRequest}
function l(a){var b="----moxieboundary"+(new Date).getTime(),c="";if(!this.getRuntime().can("send_binary_string"))throw new h.RuntimeError(h.RuntimeError.NOT_SUPPORTED_ERR);n.setRequestHeader("Content-Type","multipart/form-data; boundary="+b);a.each(function(a,d){c=a instanceof k?c+("--"+b+'\r\nContent-Disposition: form-data; name="'+d+'"; filename="'+unescape(encodeURIComponent(a.name||"blob"))+'"\r\nContent-Type: '+(a.type||"application/octet-stream")+"\r\n\r\n"+a.getSource()+"\r\n"):c+("--"+b+
'\r\nContent-Disposition: form-data; name="'+d+'"\r\n\r\n'+unescape(encodeURIComponent(a))+"\r\n")});return c+="--"+b+"--\r\n"}var r=this,n,x;g.extend(this,{send:function(a,c){var h=this,r="Mozilla"===f.browser&&f.verComp(f.version,4,">=")&&f.verComp(f.version,7,"<"),q="Android Browser"===f.browser,y=!1;x=a.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase();n=p();n.open(a.method,a.url,a.async,a.user,a.password);if(c instanceof k)c.isDetached()&&(y=!0),c=c.getSource();else if(c instanceof d){if(c.hasBlob())if(c.getBlob().isDetached())c=
l.call(h,c),y=!0;else if((r||q)&&"blob"===g.typeOf(c.getBlob().getSource())&&window.FileReader){e.call(h,a,c);return}if(c instanceof d){var C=new window.FormData;c.each(function(a,b){a instanceof k?C.append(b,a.getSource()):C.append(b,a)});c=C}}n.upload?(a.withCredentials&&(n.withCredentials=!0),n.addEventListener("load",function(a){h.trigger(a)}),n.addEventListener("error",function(a){h.trigger(a)}),n.addEventListener("progress",function(a){h.trigger(a)}),n.upload.addEventListener("progress",function(a){h.trigger({type:"UploadProgress",
loaded:a.loaded,total:a.total})})):n.onreadystatechange=function(){switch(n.readyState){case 3:var c,d;try{b.hasSameOrigin(a.url)&&(c=n.getResponseHeader("Content-Length")||0),n.responseText&&(d=n.responseText.length)}catch(f){c=d=0}h.trigger({type:"progress",lengthComputable:!!c,total:parseInt(c,10),loaded:d});break;case 4:n.onreadystatechange=function(){},0===n.status?h.trigger("error"):h.trigger("load")}};g.isEmptyObj(a.headers)||g.each(a.headers,function(a,b){n.setRequestHeader(b,a)});""!==a.responseType&&
"responseType"in n&&("json"!==a.responseType||f.can("return_response_type","json")?n.responseType=a.responseType:n.responseType="text");y?n.sendAsBinary?n.sendAsBinary(c):function(){for(var a=new Uint8Array(c.length),b=0;b<c.length;b++)a[b]=c.charCodeAt(b)&255;n.send(a.buffer)}():n.send(c);h.trigger("loadstart")},getStatus:function(){try{if(n)return n.status}catch(a){}return 0},getResponse:function(b){var d=this.getRuntime();try{switch(b){case "blob":var e=new a(d.uid,n.response),h=n.getResponseHeader("Content-Disposition");
if(h){var l=h.match(/filename=([\'\"'])([^\1]+)\1/);l&&(x=l[2])}e.name=x;e.type||(e.type=c.getFileMime(x));return e;case "json":return f.can("return_response_type","json")?n.response:200===n.status&&window.JSON?JSON.parse(n.responseText):null;case "document":var g;var k=n.responseXML,m=n.responseText;"IE"===f.browser&&m&&k&&!k.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(n.getResponseHeader("Content-Type"))&&(k=new window.ActiveXObject("Microsoft.XMLDOM"),k.async=!1,k.validateOnParse=!1,k.loadXML(m));
g=k&&("IE"===f.browser&&0!==k.parseError||!k.documentElement||"parsererror"===k.documentElement.tagName)?null:k;return g;default:return""!==n.responseText?n.responseText:null}}catch(p){return null}},getAllResponseHeaders:function(){try{return n.getAllResponseHeaders()}catch(a){}return""},abort:function(){n&&n.abort()},destroy:function(){r=x=null}})}});q("moxie/runtime/html5/utils/BinaryReader",["moxie/core/utils/Basic"],function(e){function g(a){a instanceof ArrayBuffer?c.apply(this,arguments):b.apply(this,
arguments)}function c(a){var b=new DataView(a);e.extend(this,{readByteAt:function(a){return b.getUint8(a)},writeByteAt:function(a,c){b.setUint8(a,c)},SEGMENT:function(c,e,f){switch(arguments.length){case 2:return a.slice(c,c+e);case 1:return a.slice(c);case 3:if(null===f&&(f=new ArrayBuffer),f instanceof ArrayBuffer){var g=new Uint8Array(this.length()-e+f.byteLength);0<c&&g.set(new Uint8Array(a.slice(0,c)),0);g.set(new Uint8Array(f),c);g.set(new Uint8Array(a.slice(c+e)),c+f.byteLength);this.clear();
a=g.buffer;b=new DataView(a);break}default:return a}},length:function(){return a?a.byteLength:0},clear:function(){b=a=null}})}function b(a){function b(c,e,f){f=3===arguments.length?f:a.length-e-1;a=a.substr(0,e)+c+a.substr(f+e)}e.extend(this,{readByteAt:function(b){return a.charCodeAt(b)},writeByteAt:function(a,c){b(String.fromCharCode(c),a,1)},SEGMENT:function(c,e,f){switch(arguments.length){case 1:return a.substr(c);case 2:return a.substr(c,e);case 3:b(null!==f?f:"",c,e);break;default:return a}},
length:function(){return a?a.length:0},clear:function(){a=null}})}e.extend(g.prototype,{littleEndian:!1,read:function(a,b){var c,e,f;if(a+b>this.length())throw Error("You are trying to read outside the source boundaries.");e=this.littleEndian?0:-8*(b-1);for(c=f=0;f<b;f++)c|=this.readByteAt(a+f)<<Math.abs(e+8*f);return c},write:function(a,b,c){var e,f;if(a>this.length())throw Error("You are trying to write outside the source boundaries.");e=this.littleEndian?0:-8*(c-1);for(f=0;f<c;f++)this.writeByteAt(a+
f,b>>Math.abs(e+8*f)&255)},BYTE:function(a){return this.read(a,1)},SHORT:function(a){return this.read(a,2)},LONG:function(a){return this.read(a,4)},SLONG:function(a){a=this.read(a,4);return 2147483647<a?a-4294967296:a},CHAR:function(a){return String.fromCharCode(this.read(a,1))},STRING:function(a,b){return this.asArray("CHAR",a,b).join("")},asArray:function(a,b,c){for(var e=[],f=0;f<c;f++)e[f]=this[a](b+f);return e}});return g});q("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader",
"moxie/core/Exceptions"],function(e,g){return function b(a){var k=[],d,h,f=0;a=new e(a);if(65496!==a.SHORT(0))throw a.clear(),new g.ImageError(g.ImageError.WRONG_FORMAT);for(d=2;d<=a.length();)if(h=a.SHORT(d),65488<=h&&65495>=h)d+=2;else{if(65498===h||65497===h)break;f=a.SHORT(d+2)+2;65505<=h&&65519>=h&&k.push({hex:h,name:"APP"+(h&15),start:d,length:f,segment:a.SEGMENT(d,f)});d+=f}a.clear();return{headers:k,restore:function(a){var b,f;f=new e(a);d=65504==f.SHORT(2)?4+f.SHORT(4):2;b=0;for(a=k.length;b<
a;b++)f.SEGMENT(d,0,k[b].segment),d+=k[b].length;a=f.SEGMENT();f.clear();return a},strip:function(a){var d,f;d=new b(a);f=d.headers;d.purge();d=new e(a);for(a=f.length;a--;)d.SEGMENT(f[a].start,f[a].length,"");a=d.SEGMENT();d.clear();return a},get:function(a){for(var b=[],d=0,f=k.length;d<f;d++)k[d].name===a.toUpperCase()&&b.push(k[d].segment);return b},set:function(a,b){var d=[],f,e,h;"string"===typeof b?d.push(b):d=b;f=e=0;for(h=k.length;f<h&&!(k[f].name===a.toUpperCase()&&(k[f].segment=d[e],k[f].length=
d[e].length,e++),e>=d.length);f++);},purge:function(){this.headers=k=[]}}}});q("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader","moxie/core/Exceptions"],function(e,g,c){function b(a){function k(a,b){var d,h,g,l,k,p,q;l=[];var C={},G={1:"BYTE",7:"UNDEFINED",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",9:"SLONG",10:"SRATIONAL"},B={BYTE:1,UNDEFINED:1,ASCII:1,SHORT:2,LONG:4,RATIONAL:8,SLONG:4,SRATIONAL:8};d=this.SHORT(a);for(h=0;h<d;h++)if(q=a+2+12*
h,g=b[this.SHORT(q)],g!==D){l=G[this.SHORT(q+=2)];k=this.LONG(q+=2);p=B[l];if(!p)throw new c.ImageError(c.ImageError.INVALID_META_ERR);q+=4;4<p*k&&(q=this.LONG(q)+m.tiffHeader);if(q+p*k>=this.length())throw new c.ImageError(c.ImageError.INVALID_META_ERR);"ASCII"===l?C[g]=e.trim(this.STRING(q,k).replace(/\0$/,"")):(l=this.asArray(l,q,k),k=1==k?l[0]:l,f.hasOwnProperty(g)&&"object"!=typeof k?C[g]=f[g][k]:C[g]=k)}return C}var d,h,f,m,p,l;g.call(this,a);h={tiff:{274:"Orientation",270:"ImageDescription",
271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",
41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"},thumb:{513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength"}};f={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",
13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",
16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",
79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},
Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}};m={tiffHeader:10};p=m.tiffHeader;d={clear:this.clear};e.extend(this,{read:function(){try{return b.prototype.read.apply(this,arguments)}catch(a){throw new c.ImageError(c.ImageError.INVALID_META_ERR);}},write:function(){try{return b.prototype.write.apply(this,
arguments)}catch(a){throw new c.ImageError(c.ImageError.INVALID_META_ERR);}},UNDEFINED:function(){return this.BYTE.apply(this,arguments)},RATIONAL:function(a){return this.LONG(a)/this.LONG(a+4)},SRATIONAL:function(a){return this.SLONG(a)/this.SLONG(a+4)},ASCII:function(a){return this.CHAR(a)},TIFF:function(){return l||null},EXIF:function(){var a=null;if(m.exifIFD){try{a=k.call(this,m.exifIFD,h.exif)}catch(b){return null}if(a.ExifVersion&&"array"===e.typeOf(a.ExifVersion)){for(var c=0,d="";c<a.ExifVersion.length;c++)d+=
String.fromCharCode(a.ExifVersion[c]);a.ExifVersion=d}}return a},GPS:function(){var a=null;if(m.gpsIFD){try{a=k.call(this,m.gpsIFD,h.gps)}catch(b){return null}a.GPSVersionID&&"array"===e.typeOf(a.GPSVersionID)&&(a.GPSVersionID=a.GPSVersionID.join("."))}return a},thumb:function(){if(m.IFD1)try{var a=k.call(this,m.IFD1,h.thumb);if("JPEGInterchangeFormat"in a)return this.SEGMENT(m.tiffHeader+a.JPEGInterchangeFormat,a.JPEGInterchangeFormatLength)}catch(b){}return null},setExif:function(a,b){if("PixelXDimension"!==
a&&"PixelYDimension"!==a)return!1;var c;a:{c=a;var d,f,e,g=0;if("string"===typeof c)for(f in d=h.exif,d)if(d[f]===c){c=f;break}d=m.exifIFD;f=this.SHORT(d);for(var l=0;l<f;l++)if(e=d+12*l+2,this.SHORT(e)==c){g=e+8;break}if(g){try{this.write(g,b,4)}catch(k){c=!1;break a}c=!0}else c=!1}return c},clear:function(){d.clear();a=h=f=l=m=d=null}});if(65505!==this.SHORT(0)||"EXIF\x00"!==this.STRING(4,5).toUpperCase())throw new c.ImageError(c.ImageError.INVALID_META_ERR);this.littleEndian=18761==this.SHORT(p);
if(42!==this.SHORT(p+=2))throw new c.ImageError(c.ImageError.INVALID_META_ERR);m.IFD0=m.tiffHeader+this.LONG(p+=2);l=k.call(this,m.IFD0,h.tiff);"ExifIFDPointer"in l&&(m.exifIFD=m.tiffHeader+l.ExifIFDPointer,delete l.ExifIFDPointer);"GPSInfoIFDPointer"in l&&(m.gpsIFD=m.tiffHeader+l.GPSInfoIFDPointer,delete l.GPSInfoIFDPointer);e.isEmptyObj(l)&&(l=null);if(p=this.LONG(m.IFD0+12*this.SHORT(m.IFD0)+2))m.IFD1=m.tiffHeader+p}b.prototype=g.prototype;return b});q("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic",
"moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(e,g,c,b,a){return function(k){function d(a){var b=0,c;for(a||(a=f);b<=a.length();){c=a.SHORT(b+=2);if(65472<=c&&65475>=c)return b+=5,{height:a.SHORT(b),width:a.SHORT(b+2)};c=a.SHORT(b+=2);b+=c-2}return null}function h(){var a=p.thumb(),c,f;return a&&(c=new b(a),f=d(c),c.clear(),f)?(f.data=a,f):null}var f,m,p,l;f=new b(k);if(65496!==f.SHORT(0))throw new g.ImageError(g.ImageError.WRONG_FORMAT);
m=new c(k);try{p=new a(m.get("app1")[0])}catch(r){}l=d.call(this);e.extend(this,{type:"image/jpeg",size:f.length(),width:l&&l.width||0,height:l&&l.height||0,setExif:function(a,b){if(!p)return!1;"object"===e.typeOf(a)?e.each(a,function(a,b){p.setExif(b,a)}):p.setExif(a,b);m.set("app1",p.SEGMENT())},writeHeaders:function(){return arguments.length?m.restore(arguments[0]):m.restore(k)},stripHeaders:function(a){return m.strip(a)},purge:function(){p&&m&&f&&(p.clear(),m.purge(),f.clear(),l=m=p=f=null)}});
p&&(this.meta={tiff:p.TIFF(),exif:p.EXIF(),gps:p.GPS(),thumb:h()})}});q("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(e,g,c){return function(b){function a(){k&&(k.clear(),b=d=k=null)}var k,d;k=new c(b);(function(){for(var a=0,b=0,c=[35152,20039,3338,6666],b=0;b<c.length;b++,a+=2)if(c[b]!=k.SHORT(a))throw new e.ImageError(e.ImageError.WRONG_FORMAT);})();d=function(){var a=8,b,c,d;b=k.LONG(a);c=k.STRING(a+=4,4);d=
a+=4;k.LONG(a+b);return"IHDR"==c?{width:k.LONG(d),height:k.LONG(d+4)}:null}.call(this);g.extend(this,{type:"image/png",size:k.length(),width:d.width,height:d.height,purge:function(){a.call(this)}});a.call(this)}});q("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(e,g,c,b){return function(a){var k=[c,b],d;d=function(){for(var b=0;b<k.length;b++)try{return new k[b](a)}catch(c){}throw new g.ImageError(g.ImageError.WRONG_FORMAT);
}();e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(a){return a},stripHeaders:function(a){return a},purge:function(){a=null}});e.extend(this,d);this.purge=function(){d.purge();d=null}}});q("moxie/runtime/html5/image/MegaPixel",[],function(){function e(e){var c=e.naturalWidth;if(1048576<c*e.naturalHeight){var b=document.createElement("canvas");b.width=b.height=1;b=b.getContext("2d");b.drawImage(e,-c+1,0);return 0===b.getImageData(0,0,1,1).data[3]}return!1}
return{isSubsampled:e,renderTo:function(g,c,b){var a=g.naturalWidth,k=g.naturalHeight,d=b.width,h=b.height,f=b.x||0;b=b.y||0;c=c.getContext("2d");e(g)&&(a/=2,k/=2);var m=document.createElement("canvas");m.width=m.height=1024;var p=m.getContext("2d"),l;l=k;var r=document.createElement("canvas");r.width=1;r.height=l;r=r.getContext("2d");r.drawImage(g,0,0);for(var r=r.getImageData(0,0,1,l).data,n=0,q=l,t=l;t>n;)0===r[4*(t-1)+3]?q=t:n=t,t=q+n>>1;l=t/l;l=0===l?1:l;for(r=0;r<k;){n=r+1024>k?k-r:1024;for(q=
0;q<a;)t=q+1024>a?a-q:1024,p.clearRect(0,0,1024,1024),p.drawImage(g,-q,-r),c.drawImage(m,0,0,t,n,q*d/a+f<<0,r*h/k/l+b<<0,Math.ceil(t*d/a),Math.ceil(n*h/k/l)),q+=1024;r+=1024}}}});q("moxie/runtime/html5/image/Image","moxie/runtime/html5/Runtime moxie/core/utils/Basic moxie/core/Exceptions moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/runtime/html5/image/ImageInfo moxie/runtime/html5/image/MegaPixel moxie/core/utils/Mime moxie/core/utils/Env".split(" "),function(e,g,c,b,a,k,d,h,f,m){return e.Image=
function(){function e(){if(!u&&!w)throw new c.ImageError(c.DOMException.INVALID_STATE_ERR);return u||w}function l(a){return b.atob(a.substring(a.indexOf("base64,")+7))}function r(a){var d=this;w=new Image;w.onerror=function(){t.call(this);d.trigger("error",c.ImageError.WRONG_FORMAT)};w.onload=function(){d.trigger("load")};w.src="data:"==a.substr(0,5)?a:"data:"+(C.type||"")+";base64,"+b.btoa(a)}function n(a,b){var d=this,f;if(window.FileReader)f=new FileReader,f.onload=function(){b(this.result)},f.onerror=
function(){d.trigger("error",c.ImageError.WRONG_FORMAT)},f.readAsDataURL(a);else return b(a.getAsDataURL())}function q(a,b,c,d){var f,l=0,k=0,n,r;B=d;r=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1;-1!==g.inArray(r,[5,6,7,8])&&(n=a,a=b,b=n);n=e();c?(a=Math.min(a,n.width),b=Math.min(b,n.height),f=Math.max(a/n.width,b/n.height)):f=Math.min(a/n.width,b/n.height);if(!(1<f&&!c&&d)){u||(u=document.createElement("canvas"));d=Math.round(n.width*f);f=Math.round(n.height*f);c?(u.width=a,u.height=
b,d>a&&(l=Math.round((d-a)/2)),f>b&&(k=Math.round((f-b)/2))):(u.width=d,u.height=f);if(!B){a=u.width;b=u.height;switch(r){case 5:case 6:case 7:case 8:u.width=b;u.height=a;break;default:u.width=a,u.height=b}c=u.getContext("2d");switch(r){case 2:c.translate(a,0);c.scale(-1,1);break;case 3:c.translate(a,b);c.rotate(Math.PI);break;case 4:c.translate(0,b);c.scale(1,-1);break;case 5:c.rotate(.5*Math.PI);c.scale(1,-1);break;case 6:c.rotate(.5*Math.PI);c.translate(0,-b);break;case 7:c.rotate(.5*Math.PI);
c.translate(a,-b);c.scale(-1,1);break;case 8:c.rotate(-.5*Math.PI),c.translate(-a,0)}}r=u;l=-l;k=-k;"iOS"===m.OS?h.renderTo(n,r,{width:d,height:f,x:l,y:k}):r.getContext("2d").drawImage(n,l,k,d,f);this.width=u.width;this.height=u.height;G=!0}this.trigger("Resize")}function t(){z&&(z.purge(),z=null);y=w=u=C=null;G=!1}var v=this,w,z,u,y,C,G=!1,B=!0;g.extend(this,{loadFromBlob:function(a){var b=this,d=b.getRuntime(),f=1<arguments.length?arguments[1]:!0;if(!d.can("access_binary"))throw new c.RuntimeError(c.RuntimeError.NOT_SUPPORTED_ERR);
C=a;a.isDetached()?(y=a.getSource(),r.call(this,y)):n.call(this,a.getSource(),function(a){f&&(y=l(a));r.call(b,a)})},loadFromImage:function(a,b){this.meta=a.meta;C=new k(null,{name:a.name,size:a.size,type:a.type});r.call(this,b?y=a.getAsBinaryString():a.getAsDataURL())},getInfo:function(){var b=this.getRuntime();!z&&y&&b.can("access_image_binary")&&(z=new d(y));b={width:e().width||0,height:e().height||0,type:C.type||f.getFileMime(C.name),size:y&&y.length||C.size||0,name:C.name||"",meta:z&&z.meta||
this.meta||{}};!b.meta||!b.meta.thumb||b.meta.thumb.data instanceof a||(b.meta.thumb.data=new a(null,{type:"image/jpeg",data:b.meta.thumb.data}));return b},downsize:function(){q.apply(this,arguments)},getAsCanvas:function(){u&&(u.id=this.uid+"_canvas");return u},getAsBlob:function(a,b){a!==this.type&&q.call(this,this.width,this.height,!1);return new k(null,{name:C.name||"",type:a,data:v.getAsBinaryString.call(this,a,b)})},getAsDataURL:function(a,b){var c=b||90;if(!G)return w.src;if("image/jpeg"!==
a)return u.toDataURL("image/png");try{return u.toDataURL("image/jpeg",c/100)}catch(d){return u.toDataURL("image/jpeg")}},getAsBinaryString:function(a,b){if(!G)return y||(y=l(v.getAsDataURL(a,b))),y;if("image/jpeg"!==a)y=l(v.getAsDataURL(a,b));else{var c;b||(b=90);try{c=u.toDataURL("image/jpeg",b/100)}catch(d){c=u.toDataURL("image/jpeg")}y=l(c);z&&(y=z.stripHeaders(y),B&&(z.meta&&z.meta.exif&&z.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),y=z.writeHeaders(y)),z.purge(),z=null)}G=
!1;return y},destroy:function(){v=null;t.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}});q("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(e,g,c,b,a){function k(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(c){a="0.0"}}a=a.match(/\d+/g);return parseFloat(a[0]+
"."+a[1])}function d(a){var b=c.get(a);b&&"OBJECT"==b.nodeName&&("IE"===g.browser?(b.style.display="none",function l(){if(4==b.readyState){var d=c.get(a);if(d){for(var e in d)"function"==typeof d[e]&&(d[e]=null);d.parentNode.removeChild(d)}}else setTimeout(l,10)}()):b.parentNode.removeChild(b))}var h={};a.addConstructor("flash",function(f){var m=this,p;f=e.extend({swf_url:g.swf_url},f);a.call(this,f,"flash",{access_binary:function(a){return a&&"browser"===m.mode},access_image_binary:function(a){return a&&
"browser"===m.mode},display_media:a.capTrue,do_cors:a.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===m.mode},resize_image:a.capTrue,return_response_headers:!1,return_response_type:function(a){return"json"===a&&window.JSON?!0:!e.arrayDiff(a,["","text","document"])||"browser"===m.mode},return_status_code:function(a){return"browser"===m.mode||!e.arrayDiff(a,[200,404])},select_file:a.capTrue,select_multiple:a.capTrue,send_binary_string:function(a){return a&&"browser"===m.mode},
send_browser_cookies:function(a){return a&&"browser"===m.mode},send_custom_headers:function(a){return a&&"browser"===m.mode},send_multipart:a.capTrue,slice_blob:function(a){return a&&"browser"===m.mode},stream_upload:function(a){return a&&"browser"===m.mode},summon_file_dialog:!1,upload_filesize:function(a){return 2097152>=e.parseSizeStr(a)||"client"===m.mode},use_http_method:function(a){return!e.arrayDiff(a,["GET","POST"])}},{access_binary:function(a){return a?"browser":"client"},access_image_binary:function(a){return a?
"browser":"client"},report_upload_progress:function(a){return a?"browser":"client"},return_response_type:function(a){return e.arrayDiff(a,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(a){return e.arrayDiff(a,[200,404])?"browser":["client","browser"]},send_binary_string:function(a){return a?"browser":"client"},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"browser":"client"},stream_upload:function(a){return a?
"client":"browser"},upload_filesize:function(a){return 2097152<=e.parseSizeStr(a)?"client":"browser"}},"client");10>k()&&(MXI_DEBUG&&g.debug.runtime&&g.log("\tFlash didn't meet minimal version requirement (10)."),this.mode=!1);e.extend(this,{getShim:function(){return c.get(this.uid)},shimExec:function(a,b){var c=[].slice.call(arguments,2);return m.getShim().exec(this.uid,a,b,c)},init:function(){var a,c,d;d=this.getShimContainer();e.extend(d.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",
height:"9px",overflow:"hidden"});a='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+f.swf_url+'" ';"IE"===g.browser&&(a+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');a+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+f.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+g.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';"IE"===g.browser?
(c=document.createElement("div"),d.appendChild(c),c.outerHTML=a,c=d=null):d.innerHTML=a;p=setTimeout(function(){m&&!m.initialized&&(m.trigger("Error",new b.RuntimeError(b.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&g.debug.runtime&&g.log("\tFlash failed to initialize within a specified period of time (typically 5s)."))},5E3)},destroy:function(a){return function(){d(m.uid);a.call(m);clearTimeout(p);f=p=a=m=null}}(this.destroy)},h)});return h});q("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime",
"moxie/file/File","moxie/core/utils/Basic"],function(e,g,c){return e.FileInput={init:function(b){var a=this,e=this.getRuntime();this.bind("Change",function(){var b=e.shimExec.call(a,"FileInput","getFiles");a.files=[];c.each(b,function(b){a.files.push(new g(e.uid,b))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",{name:b.name,accept:b.accept,multiple:b.multiple});this.trigger("ready")}}});q("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(e,
g){return e.Blob={slice:function(c,b,a,e){var d=this.getRuntime();0>b?b=Math.max(c.size+b,0):0<b&&(b=Math.min(b,c.size));0>a?a=Math.max(c.size+a,0):0<a&&(a=Math.min(a,c.size));(c=d.shimExec.call(this,"Blob","slice",b,a,e||""))&&(c=new g(d.uid,c));return c}}});q("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(e,g){function c(b,a){switch(a){case "readAsText":return g.atob(b,"utf8");case "readAsBinaryString":return g.atob(b);case "readAsDataURL":return b}return null}
return e.FileReader={read:function(b,a){var e=this;e.result="";"readAsDataURL"===b&&(e.result="data:"+(a.type||"")+";base64,");e.bind("Progress",function(a,g){g&&(e.result+=c(g,b))},999);return e.getRuntime().shimExec.call(this,"FileReader","readAsBase64",a.uid)}}});q("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(e,g){function c(b,a){switch(a){case "readAsText":return g.atob(b,"utf8");case "readAsBinaryString":return g.atob(b);case "readAsDataURL":return b}return null}
return e.FileReaderSync={read:function(b,a){var e;e=this.getRuntime().shimExec.call(this,"FileReaderSync","readAsBase64",a.uid);if(!e)return null;"readAsDataURL"===b&&(e="data:"+(a.type||"")+";base64,"+e);return c(e,b,a.type)}}});q("moxie/runtime/flash/xhr/XMLHttpRequest","moxie/runtime/flash/Runtime moxie/core/utils/Basic moxie/file/Blob moxie/file/File moxie/file/FileReaderSync moxie/xhr/FormData moxie/runtime/Transporter".split(" "),function(e,g,c,b,a,k,d){return e.XMLHttpRequest={send:function(a,
b){function e(){a.transport=n.mode;n.shimExec.call(r,"XMLHttpRequest","send",a,b)}function p(a,c){n.shimExec.call(r,"XMLHttpRequest","appendBlob",a,c.uid);b=null;e()}function l(a,b){var c=new d;c.bind("TransportingComplete",function(){b(this.result)});c.transport(a.getSource(),a.type,{ruid:n.uid})}var r=this,n=r.getRuntime();g.isEmptyObj(a.headers)||g.each(a.headers,function(a,b){n.shimExec.call(r,"XMLHttpRequest","setRequestHeader",b,a.toString())});if(b instanceof k){var q;b.each(function(a,b){a instanceof
c?q=b:n.shimExec.call(r,"XMLHttpRequest","append",b,a)});if(b.hasBlob()){var t=b.getBlob();t.isDetached()?l(t,function(a){t.destroy();p(q,a)}):p(q,t)}else b=null,e()}else b instanceof c?b.isDetached()?l(b,function(a){b.destroy();b=a.uid;e()}):(b=b.uid,e()):e()},getResponse:function(c){var d,e,k=this.getRuntime();if(e=k.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){e=new b(k.uid,e);if("blob"===c)return e;try{d=new a;if(~g.inArray(c,["","text"]))return d.readAsText(e);if("json"===c&&window.JSON)return JSON.parse(d.readAsText(e))}finally{e.destroy()}}return null},
abort:function(a){this.getRuntime().shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}}});q("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(e,g){return e.Transporter={getAsBlob:function(c){var b=this.getRuntime();return(c=b.shimExec.call(this,"Transporter","getAsBlob",c))?new g(b.uid,c):null}}});q("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic",
"moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(e,g,c,b,a){return e.Image={loadFromBlob:function(a){function b(a){f.shimExec.call(e,"Image","loadFromBlob",a.uid);e=f=null}var e=this,f=e.getRuntime();if(a.isDetached()){var g=new c;g.bind("TransportingComplete",function(){b(g.result.getSource())});g.transport(a.getSource(),a.type,{ruid:f.uid})}else b(a.getSource())},loadFromImage:function(a){return this.getRuntime().shimExec.call(this,"Image","loadFromImage",a.uid)},
getInfo:function(){var a=this.getRuntime(),c=a.shimExec.call(this,"Image","getInfo");!c.meta||!c.meta.thumb||c.meta.thumb.data instanceof b||(c.meta.thumb.data=new b(a.uid,c.meta.thumb.data));return c},getAsBlob:function(a,c){var e=this.getRuntime(),f=e.shimExec.call(this,"Image","getAsBlob",a,c);return f?new b(e.uid,f):null},getAsDataURL:function(){var b=this.getRuntime().Image.getAsBlob.apply(this,arguments);return b?(new a).readAsDataURL(b):null}}});q("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic",
"moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(e,g,c,b,a){function k(a){var b=!1,c=null,d,e,g,k,q,t=0;try{try{c=new ActiveXObject("AgControl.AgControl"),c.IsVersionSupported(a)&&(b=!0)}catch(w){var v=navigator.plugins["Silverlight Plug-In"];if(v){d=v.description;"1.0.30226.2"===d&&(d="2.0.30226.2");for(e=d.split(".");3<e.length;)e.pop();for(;4>e.length;)e.push(0);for(g=a.split(".");4<g.length;)g.pop();do k=parseInt(g[t],10),q=parseInt(e[t],
10),t++;while(t<g.length&&k===q);k<=q&&!isNaN(k)&&(b=!0)}}}catch(w){b=!1}return b}var d={};a.addConstructor("silverlight",function(h){var f=this,m;h=e.extend({xap_url:g.xap_url},h);a.call(this,h,"silverlight",{access_binary:a.capTrue,access_image_binary:a.capTrue,display_media:a.capTrue,do_cors:a.capTrue,drag_and_drop:!1,report_upload_progress:a.capTrue,resize_image:a.capTrue,return_response_headers:function(a){return a&&"client"===f.mode},return_response_type:function(a){return"json"!==a?!0:!!window.JSON},
return_status_code:function(a){return"client"===f.mode||!e.arrayDiff(a,[200,404])},select_file:a.capTrue,select_multiple:a.capTrue,send_binary_string:a.capTrue,send_browser_cookies:function(a){return a&&"browser"===f.mode},send_custom_headers:function(a){return a&&"client"===f.mode},send_multipart:a.capTrue,slice_blob:a.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:a.capTrue,use_http_method:function(a){return"client"===f.mode||!e.arrayDiff(a,["GET","POST"])}},{return_response_headers:function(a){return a?
"client":"browser"},return_status_code:function(a){return e.arrayDiff(a,[200,404])?"client":["client","browser"]},send_browser_cookies:function(a){return a?"browser":"client"},send_custom_headers:function(a){return a?"client":"browser"},use_http_method:function(a){return e.arrayDiff(a,["GET","POST"])?"client":["client","browser"]}});k("2.0.31005.0")&&"Opera"!==g.browser||(MXI_DEBUG&&g.debug.runtime&&g.log("\tSilverlight is not installed or minimal version (2.0.31005.0) requirement not met (not likely)."),
this.mode=!1);e.extend(this,{getShim:function(){return c.get(this.uid).content.Moxie},shimExec:function(a,b){var c=[].slice.call(arguments,2);return f.getShim().exec(this.uid,a,b,c)},init:function(){this.getShimContainer().innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+h.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+
this.uid+",target="+g.global_event_dispatcher+'"/></object>';m=setTimeout(function(){f&&!f.initialized&&(f.trigger("Error",new b.RuntimeError(b.RuntimeError.NOT_INIT_ERR)),MXI_DEBUG&&g.debug.runtime&&g.log("Silverlight failed to initialize within a specified period of time (5-10s)."))},"Windows"!==g.OS?1E4:5E3)},destroy:function(a){return function(){a.call(f);clearTimeout(m);h=m=a=f=null}}(this.destroy)},d)});return d});q("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime",
"moxie/file/File","moxie/core/utils/Basic"],function(e,g,c){return e.FileInput={init:function(b){var a=this,e=this.getRuntime();this.bind("Change",function(){var b=e.shimExec.call(a,"FileInput","getFiles");a.files=[];c.each(b,function(b){a.files.push(new g(e.uid,b))})},999);this.getRuntime().shimExec.call(this,"FileInput","init",function(a){for(var b="",c=0;c<a.length;c++)b+=(""!==b?"|":"")+a[c].title+" | *."+a[c].extensions.replace(/,/g,";*.");return b}(b.accept),b.name,b.multiple);this.trigger("ready")}}});
q("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(e,g,c){return e.Blob=g.extend({},c)});q("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(e,g,c){return e.FileDrop={init:function(){var b=this.getRuntime(),a;a=b.getShimContainer();c.addEvent(a,"dragover",function(a){a.preventDefault();a.stopPropagation();a.dataTransfer.dropEffect=
"copy"},this.uid);c.addEvent(a,"dragenter",function(a){a.preventDefault();g.get(b.uid).dragEnter(a)&&a.stopPropagation()},this.uid);c.addEvent(a,"drop",function(a){a.preventDefault();g.get(b.uid).dragDrop(a)&&a.stopPropagation()},this.uid);return b.shimExec.call(this,"FileDrop","init")}}});q("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(e,g,c){return e.FileReader=g.extend({},c)});q("moxie/runtime/silverlight/file/FileReaderSync",
["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(e,g,c){return e.FileReaderSync=g.extend({},c)});q("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(e,g,c){return e.XMLHttpRequest=g.extend({},c)});q("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],
function(e,g,c){return e.Transporter=g.extend({},c)});q("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/runtime/flash/image/Image"],function(e,g,c,b){return e.Image=g.extend({},b,{getInfo:function(){var a=this.getRuntime(),b=["tiff","exif","gps","thumb"],d={meta:{}},e=a.shimExec.call(this,"Image","getInfo");e.meta&&(g.each(b,function(a){var b=e.meta[a],c,g,k,n;if(b&&b.keys)for(d.meta[a]={},g=0,k=b.keys.length;g<k;g++)if(c=
b.keys[g],n=b[c])/^(\d|[1-9]\d+)$/.test(n)?n=parseInt(n,10):/^\d*\.\d+$/.test(n)&&(n=parseFloat(n)),d.meta[a][c]=n}),!d.meta||!d.meta.thumb||d.meta.thumb.data instanceof c||(d.meta.thumb.data=new c(a.uid,d.meta.thumb.data)));d.width=parseInt(e.width,10);d.height=parseInt(e.height,10);d.size=parseInt(e.size,10);d.type=e.type;d.name=e.name;return d}})});q("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(e,g,c,b){var a=
{};c.addConstructor("html4",function(g){var d=this,h=c.capTest,f=c.capTrue;c.call(this,g,"html4",{access_binary:h(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:h(a.Image&&(b.can("create_canvas")||b.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:h("Chrome"===b.browser&&b.verComp(b.version,28,">=")||"IE"===b.browser&&b.verComp(b.version,10,">=")||"Safari"===b.browser&&b.verComp(b.version,7,">=")),resize_image:function(){return a.Image&&
d.can("access_binary")&&b.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(a){return"json"===a&&window.JSON?!0:!!~e.inArray(a,["text","document",""])},return_status_code:function(a){return!e.arrayDiff(a,[200,404])},select_file:function(){return b.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return d.can("select_file")},summon_file_dialog:function(){return d.can("select_file")&&
("Firefox"===b.browser&&b.verComp(b.version,4,">=")||"Opera"===b.browser&&b.verComp(b.version,12,">=")||"IE"===b.browser&&b.verComp(b.version,10,">=")||!!~e.inArray(b.browser,["Chrome","Safari"]))},upload_filesize:f,use_http_method:function(a){return!e.arrayDiff(a,["GET","POST"])}});e.extend(this,{init:function(){this.trigger("Init")},destroy:function(a){return function(){a.call(d);a=d=null}}(this.destroy)});e.extend(this.getShim(),a)});return a});q("moxie/runtime/html4/file/FileInput","moxie/runtime/html4/Runtime moxie/file/File moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Events moxie/core/utils/Mime moxie/core/utils/Env".split(" "),
function(e,g,c,b,a,k,d){return e.FileInput=function(){function e(){var l=this,k=l.getRuntime(),n,q,t,v,w;w=c.guid("uid_");n=k.getShimContainer();f&&(q=b.get(f+"_form"))&&c.extend(q.style,{top:"100%"});t=document.createElement("form");t.setAttribute("id",w+"_form");t.setAttribute("method","post");t.setAttribute("enctype","multipart/form-data");t.setAttribute("encoding","multipart/form-data");c.extend(t.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});v=document.createElement("input");
v.setAttribute("id",w);v.setAttribute("type","file");v.setAttribute("name",p.name||"Filedata");v.setAttribute("accept",m.join(","));c.extend(v.style,{fontSize:"999px",opacity:0});t.appendChild(v);n.appendChild(t);c.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});"IE"===d.browser&&d.verComp(d.version,10,"<")&&c.extend(v.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});v.onchange=function(){var a;if(this.value){if(this.files){if(a=this.files[0],0===
a.size){t.parentNode.removeChild(t);return}}else a={name:this.value};a=new g(k.uid,a);this.onchange=function(){};e.call(l);l.files=[a];v.setAttribute("id",a.uid);t.setAttribute("id",a.uid+"_form");l.trigger("change");v=t=null}};k.can("summon_file_dialog")&&(n=b.get(p.browse_button),a.removeEvent(n,"click",l.uid),a.addEvent(n,"click",function(a){v&&!v.disabled&&v.click();a.preventDefault()},l.uid));f=w;n=q=n=null}var f,m=[],p;c.extend(this,{init:function(c){var d=this,f=d.getRuntime(),g;p=c;m=c.accept.mimes||
k.extList2mimes(c.accept,f.can("filter_by_extension"));g=f.getShimContainer();(function(){var e,h;e=b.get(c.browse_button);f.can("summon_file_dialog")&&("static"===b.getStyle(e,"position")&&(e.style.position="relative"),h=parseInt(b.getStyle(e,"z-index"),10)||1,e.style.zIndex=h,g.style.zIndex=h-1);e=f.can("summon_file_dialog")?e:g;a.addEvent(e,"mouseover",function(){d.trigger("mouseenter")},d.uid);a.addEvent(e,"mouseout",function(){d.trigger("mouseleave")},d.uid);a.addEvent(e,"mousedown",function(){d.trigger("mousedown")},
d.uid);a.addEvent(b.get(c.container),"mouseup",function(){d.trigger("mouseup")},d.uid);e=null})();e.call(this);g=null;d.trigger({type:"ready",async:!0})},disable:function(a){var c;if(c=b.get(f))c.disabled=!!a},destroy:function(){var c=this.getRuntime(),d=c.getShim(),c=c.getShimContainer();a.removeAllEvents(c,this.uid);a.removeAllEvents(p&&b.get(p.container),this.uid);a.removeAllEvents(p&&b.get(p.browse_button),this.uid);c&&(c.innerHTML="");d.removeInstance(this.uid);f=m=p=null}})}});q("moxie/runtime/html4/file/FileReader",
["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(e,g){return e.FileReader=g});q("moxie/runtime/html4/xhr/XMLHttpRequest","moxie/runtime/html4/Runtime moxie/core/utils/Basic moxie/core/utils/Dom moxie/core/utils/Url moxie/core/Exceptions moxie/core/utils/Events moxie/file/Blob moxie/xhr/FormData".split(" "),function(e,g,c,b,a,k,d,h){return e.XMLHttpRequest=function(){function e(a){var b=this,d,f,g,h=!1;if(l){d=l.id.replace(/_iframe$/,"");if(d=c.get(d+"_form")){f=d.getElementsByTagName("input");
for(g=f.length;g--;)switch(f[g].getAttribute("type")){case "hidden":f[g].parentNode.removeChild(f[g]);break;case "file":h=!0}f=[];h||d.parentNode.removeChild(d);d=null}setTimeout(function(){k.removeEvent(l,"load",b.uid);l.parentNode&&l.parentNode.removeChild(l);var c=b.getRuntime().getShimContainer();c.children.length||c.parentNode.removeChild(c);l=null;a()},1)}}var m,p,l;g.extend(this,{send:function(q,n){var x=this,t=x.getRuntime(),v,w,z,u;m=p=null;if(n instanceof h&&n.hasBlob()){if(u=n.getBlob(),
v=u.uid,z=c.get(v),w=c.get(v+"_form"),!w)throw new a.DOMException(a.DOMException.NOT_FOUND_ERR);}else v=g.guid("uid_"),w=document.createElement("form"),w.setAttribute("id",v+"_form"),w.setAttribute("method",q.method),w.setAttribute("enctype","multipart/form-data"),w.setAttribute("encoding","multipart/form-data"),t.getShimContainer().appendChild(w);w.setAttribute("target",v+"_iframe");n instanceof h&&n.each(function(a,b){if(a instanceof d)z&&z.setAttribute("name",b);else{var c=document.createElement("input");
g.extend(c,{type:"hidden",name:b,value:a});z?w.insertBefore(c,z):w.appendChild(c)}});w.setAttribute("action",q.url);(function(){var a=t.getShimContainer()||document.body,c=document.createElement("div");c.innerHTML='<iframe id="'+v+'_iframe" name="'+v+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';l=c.firstChild;a.appendChild(l);k.addEvent(l,"load",function(){var a;try{a=l.contentWindow.document||l.contentDocument||window.frames[l.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(a.title)?
m=a.title.replace(/^(\d+).*$/,"$1"):(m=200,p=g.trim(a.body.innerHTML),x.trigger({type:"progress",loaded:p.length,total:p.length}),u&&x.trigger({type:"uploadprogress",loaded:u.size||1025,total:u.size||1025}))}catch(c){if(b.hasSameOrigin(q.url))m=404;else{e.call(x,function(){x.trigger("error")});return}}e.call(x,function(){x.trigger("load")})},x.uid)})();w.submit();x.trigger("loadstart")},getStatus:function(){return m},getResponse:function(a){if("json"===a&&"string"===g.typeOf(p)&&window.JSON)try{return JSON.parse(p.replace(/^\s*<pre[^>]*>/,
"").replace(/<\/pre>\s*$/,""))}catch(b){return null}return p},abort:function(){var a=this;l&&l.contentWindow&&(l.contentWindow.stop?l.contentWindow.stop():l.contentWindow.document.execCommand?l.contentWindow.document.execCommand("Stop"):l.src="about:blank");e.call(this,function(){a.dispatchEvent("abort")})}})}});q("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(e,g){return e.Image=g});(function(e){for(var g=0;g<e.length;g++){for(var c=B,
b=e[g],a=b.split(/[.\/]/),k=0;k<a.length-1;++k)c[a[k]]===D&&(c[a[k]]={}),c=c[a[k]];c[a[a.length-1]]=F[b]}})("moxie/core/utils/Basic moxie/core/utils/Env moxie/core/I18n moxie/core/utils/Mime moxie/core/utils/Dom moxie/core/Exceptions moxie/core/EventTarget moxie/runtime/Runtime moxie/runtime/RuntimeClient moxie/file/FileInput moxie/core/utils/Encode moxie/file/Blob moxie/file/File moxie/file/FileDrop moxie/file/FileReader moxie/core/utils/Url moxie/runtime/RuntimeTarget moxie/file/FileReaderSync moxie/xhr/FormData moxie/xhr/XMLHttpRequest moxie/runtime/Transporter moxie/image/Image moxie/core/utils/Events".split(" "))})(this);
(function(B){var D={},N=B.moxie.core.utils.Basic.inArray;(function F(e){var g,c;for(g in e)c=typeof e[g],"object"!==c||~N(g,["Exceptions","Env","Mime"])?"function"===c&&(D[g]=e[g]):F(e[g])})(B.moxie);D.Env=B.moxie.core.utils.Env;D.Mime=B.moxie.core.utils.Mime;D.Exceptions=B.moxie.core.Exceptions;B.mOxie=D;B.o||(B.o=D);return D})(this);
