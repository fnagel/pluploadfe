(function(w,x,f,h,c){function e(a){return f.translate(a)||a}var u={};c.widget("ui.plupload",{widgetEventPrefix:"",contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",filters:{},buttons:{browse:!0,start:!0,stop:!0},views:{list:!0,thumbs:!1,active:"list",remember:!0},thumb_width:100,thumb_height:60,multiple_queues:!0,dragdrop:!0,autostart:!1,sortable:!1,rename:!1},FILE_COUNT_ERROR:-9001,_create:function(){var a=this.element.attr("id");a||(a=f.guid(),
this.element.attr("id",a));this.id=a;this.contents_bak=this.element.html();var b=this.element;b.id=b.attr("id");b.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_logo"> </div><div class="plupload_header_title">'+e("Select files")+'</div><div class="plupload_header_text">'+e("Add files to the upload queue and click the start button.")+'</div><div class="plupload_view_switch"><input type="radio" id="'+
b.id+'_view_list" name="view_mode_'+b.id+'" checked="checked" /><label class="plupload_button" for="'+b.id+'_view_list" data-view="list">'+e("List")+'</label><input type="radio" id="'+b.id+'_view_thumbs" name="view_mode_'+b.id+'" /><label class="plupload_button"  for="'+b.id+'_view_thumbs" data-view="thumbs">'+e("Thumbnails")+'</label></div></div></div><table class="plupload_filelist plupload_filelist_header ui-widget-header"><tr><td class="plupload_cell plupload_file_name">'+e("Filename")+'</td><td class="plupload_cell plupload_file_status">'+
e("Status")+'</td><td class="plupload_cell plupload_file_size">'+e("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_content"><div class="plupload_droptext">'+e("Drag files here.")+'</div><ul class="plupload_filelist_content"> </ul><div class="plupload_clearer">&nbsp;</div></div><table class="plupload_filelist plupload_filelist_footer ui-widget-header"><tr><td class="plupload_cell plupload_file_name"><div class="plupload_buttons">\x3c!-- Visible --\x3e<a class="plupload_button plupload_add">'+
e("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+e("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+e("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden">\x3c!-- Hidden --\x3e<div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div><input class="plupload_count" value="0" type="hidden"></div>');
this.container=c(".plupload_container",this.element).attr("id",a+"_container");this.content=c(".plupload_content",this.element);c.fn.resizable&&this.container.resizable({handles:"s",minHeight:300});this.filelist=c(".plupload_filelist_content",this.container).attr({id:a+"_filelist",unselectable:"on"});this.browse_button=c(".plupload_add",this.container).attr("id",a+"_browse");this.start_button=c(".plupload_start",this.container).attr("id",a+"_start");this.stop_button=c(".plupload_stop",this.container).attr("id",
a+"_stop");this.thumbs_switcher=c("#"+a+"_view_thumbs");this.list_switcher=c("#"+a+"_view_list");c.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:!0}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}}),this.list_switcher.button({text:!1,icons:{secondary:"ui-icon-grip-dotted-horizontal"}}),this.thumbs_switcher.button({text:!1,icons:{secondary:"ui-icon-image"}}));this.progressbar=
c(".plupload_progress_container",this.container);c.ui.progressbar&&this.progressbar.progressbar();this.counter=c(".plupload_count",this.element).attr({id:a+"_count",name:a+"_count"});this._initUploader()},_initUploader:function(){var a=this,b=this.id,d={container:b+"_buttons",browse_button:b+"_browse"};c(".plupload_buttons",this.element).attr("id",b+"_buttons");a.options.dragdrop&&(this.filelist.parent().attr("id",this.id+"_dropbox"),d.drop_element=this.id+"_dropbox");this.filelist.on("click",function(b){c(b.target).hasClass("plupload_action_icon")&&
(a.removeFile(c(b.target).closest(".plupload_file").attr("id")),b.preventDefault())});b=this.uploader=u[b]=new f.Uploader(c.extend(this.options,d));this.options=b.getOption();a.options.views.thumbs&&(b.settings.required_features.display_media=!0);a.options.max_file_count&&f.extend(b.getOption("filters"),{max_file_count:a.options.max_file_count});f.addFileFilter("max_file_count",function(b,c,d){b<=this.files.length-(this.total.uploaded+this.total.failed)?(a.browse_button.button("disable"),this.disableBrowse(),
this.trigger("Error",{code:a.FILE_COUNT_ERROR,message:e("File count error."),file:c}),d(!1)):d(!0)});b.bind("Error",function(b,c){var d,k="";d="<strong>"+c.message+"</strong>";switch(c.code){case f.FILE_EXTENSION_ERROR:k=h.sprintf(e("File: %s"),c.file.name);break;case f.FILE_SIZE_ERROR:k=h.sprintf(e("File: %s, size: %d, max file size: %d"),c.file.name,f.formatSize(c.file.size),f.formatSize(f.parseSize(b.getOption("filters").max_file_size)));break;case f.FILE_DUPLICATE_ERROR:k=h.sprintf(e("%s already present in the queue."),
c.file.name);break;case a.FILE_COUNT_ERROR:k=h.sprintf(e("Upload element accepts only %d file(s) at a time. Extra files were stripped."),b.getOption("filters").max_file_count||0);break;case f.IMAGE_FORMAT_ERROR:k=e("Image format either wrong or not supported.");break;case f.IMAGE_MEMORY_ERROR:k=e("Runtime ran out of available memory.");break;case f.HTTP_ERROR:k=e("Upload URL might be wrong or doesn't exist.")}d+=" <br /><i>"+k+"</i>";a._trigger("error",null,{up:b,error:c});c.code===f.INIT_ERROR?setTimeout(function(){a.destroy()},
1):a.notify("error",d)});b.bind("PostInit",function(b){a.options.buttons.browse?a.browse_button.button("enable"):(a.browse_button.button("disable").hide(),b.disableBrowse(!0));a.options.buttons.start||a.start_button.button("disable").hide();a.options.buttons.stop||a.stop_button.button("disable").hide();!a.options.unique_names&&a.options.rename&&a._enableRenaming();a.options.dragdrop&&b.features.dragdrop&&a.filelist.parent().addClass("plupload_dropbox");a._enableViewSwitcher();a.start_button.click(function(b){c(this).button("option",
"disabled")||a.start();b.preventDefault()});a.stop_button.click(function(b){a.stop();b.preventDefault()});a._trigger("ready",null,{up:b})});b.init();b.bind("FileFiltered",function(b,c){a._addFiles(c)});b.bind("FilesAdded",function(b,d){a._trigger("selected",null,{up:b,files:d});a.options.sortable&&c.ui.sortable&&a._enableSortingList();a._trigger("updatelist",null,{filelist:a.filelist});a.options.autostart&&setTimeout(function(){a.start()},10)});b.bind("FilesRemoved",function(b,d){c.ui.sortable&&a.options.sortable&&
c("tbody",a.filelist).sortable("destroy");c.each(d,function(a,b){c("#"+b.id).toggle("highlight",function(){c(this).remove()})});b.files.length&&a.options.sortable&&c.ui.sortable&&a._enableSortingList();a._trigger("updatelist",null,{filelist:a.filelist});a._trigger("removed",null,{up:b,files:d})});b.bind("QueueChanged",function(){a._handleState()});b.bind("StateChanged",function(b){a._handleState();f.STARTED===b.state?a._trigger("started",null,{up:this.uploader}):f.STOPPED===b.state&&a._trigger("stopped",
null,{up:this.uploader})});b.bind("UploadFile",function(b,c){a._handleFileStatus(c)});b.bind("FileUploaded",function(b,c,d){a._handleFileStatus(c);a._trigger("uploaded",null,{up:b,file:c,result:d})});b.bind("UploadProgress",function(b,c){a._handleFileStatus(c);a._updateTotalProgress();a._trigger("progress",null,{up:b,file:c})});b.bind("UploadComplete",function(b,c){a._addFormFields();a._trigger("complete",null,{up:b,files:c})})},_setOption:function(a,b){"buttons"==a&&"object"==typeof b&&(b=c.extend(this.options.buttons,
b),b.browse?(this.browse_button.button("enable").show(),this.uploader.disableBrowse(!1)):(this.browse_button.button("disable").hide(),this.uploader.disableBrowse(!0)),b.start?this.start_button.button("enable").show():this.start_button.button("disable").hide(),b.stop?this.start_button.button("enable").show():this.stop_button.button("disable").hide());this.uploader.setOption(a,b)},start:function(){this.uploader.start()},stop:function(){this.uploader.stop()},enable:function(){this.browse_button.button("enable");
this.uploader.disableBrowse(!1)},disable:function(){this.browse_button.button("disable");this.uploader.disableBrowse(!0)},getFile:function(a){return"number"===typeof a?this.uploader.files[a]:this.uploader.getFile(a)},getFiles:function(){return this.uploader.files},removeFile:function(a){"string"===f.typeOf(a)&&(a=this.getFile(a));this.uploader.removeFile(a)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(a,
b){var d=c('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+e("Close")+'"></span><p><span class="ui-icon"></span>'+b+"</p></div>");d.addClass("ui-state-"+("error"===a?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+("error"===a?"alert":"info")).end().find(".plupload_message_close").click(function(){d.remove()}).end();c(".plupload_header",this.container).append(d)},destroy:function(){this.uploader.destroy();c(".plupload_button",
this.element).unbind();c.ui.button&&c(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy");c.ui.progressbar&&this.progressbar.progressbar("destroy");c.ui.sortable&&this.options.sortable&&c("tbody",this.filelist).sortable("destroy");this.element.empty().html(this.contents_bak);this.contents_bak="";c.Widget.prototype.destroy.apply(this)},_handleState:function(){var a=this.uploader,b=a.files.length-(a.total.uploaded+a.total.failed),d=a.getOption("filters").max_file_count||
0;f.STARTED===a.state?(c([]).add(this.stop_button).add(".plupload_started").removeClass("plupload_hidden"),this.start_button.button("disable"),this.options.multiple_queues||(this.browse_button.button("disable"),a.disableBrowse()),c(".plupload_upload_status",this.element).html(h.sprintf(e("Uploaded %d/%d files"),a.total.uploaded,a.files.length)),c(".plupload_header_content",this.element).addClass("plupload_header_content_bw")):f.STOPPED===a.state&&(c([]).add(this.stop_button).add(".plupload_started").addClass("plupload_hidden"),
b?this.start_button.button("enable"):this.start_button.button("disable"),this.options.multiple_queues&&c(".plupload_header_content",this.element).removeClass("plupload_header_content_bw"),this.options.multiple_queues&&d&&d>b&&(this.browse_button.button("enable"),a.disableBrowse(!1)),this._updateTotalProgress());0===a.total.queued?c(".ui-button-text",this.browse_button).html(e("Add Files")):c(".ui-button-text",this.browse_button).html(h.sprintf(e("%d files queued"),a.total.queued));a.refresh()},_handleFileStatus:function(a){var b=
c("#"+a.id),d,n;if(b.length){switch(a.status){case f.DONE:d="plupload_done";n="plupload_action_icon ui-icon ui-icon-circle-check";break;case f.FAILED:d="ui-state-error plupload_failed";n="plupload_action_icon ui-icon ui-icon-alert";break;case f.QUEUED:d="plupload_delete";n="plupload_action_icon ui-icon ui-icon-circle-minus";break;case f.UPLOADING:d="ui-state-highlight plupload_uploading";n="plupload_action_icon ui-icon ui-icon-circle-arrow-w";var l=c(".plupload_scroll",this.container),g=l.scrollTop(),
e=l.height(),m=b.position().top+b.height();e<m&&l.scrollTop(g+m-e);b.find(".plupload_file_percent").html(a.percent+"%").end().find(".plupload_file_progress").css("width",a.percent+"%").end().find(".plupload_file_size").html(f.formatSize(a.size))}b.attr("class",d+" ui-state-default plupload_file").find(".plupload_action_icon").attr("class",n)}},_updateTotalProgress:function(){var a=this.uploader;this.filelist[0].scrollTop=this.filelist[0].scrollHeight;this.progressbar.progressbar("value",a.total.percent);
this.element.find(".plupload_total_status").html(a.total.percent+"%").end().find(".plupload_total_file_size").html(f.formatSize(a.total.size)).end().find(".plupload_upload_status").html(h.sprintf(e("Uploaded %d/%d files"),a.total.uploaded,a.files.length))},_displayThumbs:function(){function a(a,b,c){var d;a.on(b,function(){clearTimeout(d);d=setTimeout(function(){clearTimeout(d);c()},300)})}function b(){var a=Math.floor(g.content.scrollTop()/m)*p;q=c(".plupload_file .plupload_file_thumb",g.filelist).slice(a,
a+t).filter(".plupload_thumb_toload").get()}function d(){function d(){if("thumbs"===g.view_mode){if(!k||!m){var a=c(".plupload_file:eq(0)",g.filelist);k=a.outerWidth(!0);m=a.outerHeight(!0)}var a=g.content.width(),f=g.content.height();p=Math.floor(a/k);t=p*(Math.ceil(f/m)+1);b();e()}}c.fn.resizable&&a(g.container,"resize",d);a(g.window,"resize",d);a(g.content,"scroll",d);g.element.on("viewchanged selected",d);d()}function f(a,b){var d=new h.Image;d.onload=function(){var b=c("#"+a.id+" .plupload_file_thumb",
g.filelist);this.embed(b[0],{width:g.options.thumb_width,height:g.options.thumb_height,crop:!0,preserveHeaders:!1,swf_url:h.resolveUrl(g.options.flash_swf_url),xap_url:h.resolveUrl(g.options.silverlight_xap_url)})};d.bind("embedded error",function(d){c("#"+a.id,g.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_loading").addClass("plupload_thumb_"+d.type);this.destroy();setTimeout(b,1)});c("#"+a.id,g.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_toload").addClass("plupload_thumb_loading");
d.load(a.getSource())}function e(){"thumbs"!==g.view_mode||r||(b(),q.length&&(r=!0,f(g.getFile(c(q.shift()).closest(".plupload_file").attr("id")),function(){r=!1;e()})))}var g=this,k,m,p,t=0,q=[],r=!1;if(this.options.views.thumbs)this.element.on("selected",function v(){g.element.off("selected",v);d()})},_addFiles:function(a){var b=this,d="";"array"!==f.typeOf(a)&&(a=[a]);c.each(a,function(a,c){var e=h.Mime.getFileExtension(c.name)||"none";d+='<li class="plupload_file ui-state-default plupload_delete" id="{id}" style="width:{thumb_width}px;"><div class="plupload_file_thumb plupload_thumb_toload" style="width: {thumb_width}px; height: {thumb_height}px;"><div class="plupload_file_dummy ui-widget-content" style="line-height: {thumb_height}px;"><span class="ui-state-disabled">{ext} </span></div></div><div class="plupload_file_status"><div class="plupload_file_progress ui-widget-header" style="width: 0%"> </div><span class="plupload_file_percent">{percent} </span></div><div class="plupload_file_name" title="{name}"><span class="plupload_file_name_wrapper">{name} </span></div><div class="plupload_file_action"><div class="plupload_action_icon ui-icon ui-icon-circle-minus"> </div></div><div class="plupload_file_size">{size} </div><div class="plupload_file_fields"> </div></li>'.replace(/\{(\w+)\}/g,
function(a,d){switch(d){case "thumb_width":case "thumb_height":return b.options[d];case "size":return f.formatSize(c.size);case "ext":return e;default:return c[d]||""}})});b.filelist.append(d)},_addFormFields:function(){var a=this;c(".plupload_file_fields",this.filelist).html("");f.each(this.uploader.files,function(b,d){var e="",l=a.id+"_"+d;b.target_name&&(e+='<input type="hidden" name="'+l+'_tmpname" value="'+f.xmlEncode(b.target_name)+'" />');e+='<input type="hidden" name="'+l+'_name" value="'+
f.xmlEncode(b.name)+'" />';e+='<input type="hidden" name="'+l+'_status" value="'+(b.status===f.DONE?"done":"failed")+'" />';c("#"+b.id).find(".plupload_file_fields").html(e)});this.counter.val(this.uploader.files.length)},_viewChanged:function(a){this.options.views.remember&&c.cookie&&c.cookie("plupload_ui_view",a,{expires:7,path:"/"});"IE"===h.Env.browser&&7>h.Env.version&&this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+("list"===a?132:
102)+")");this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+a);this.view_mode=a;this._trigger("viewchanged",null,{view:a})},_enableViewSwitcher:function(){var a=this,b,d=c(".plupload_view_switch",this.container),e;f.each(["list","thumbs"],function(b){a.options.views[b]||d.find('[for="'+a.id+"_view_"+b+'"], #'+a.id+"_view_"+b).remove()});e=d.find(".plupload_button");1===e.length?(d.hide(),b=e.eq(0).data("view"),this._viewChanged(b)):c.ui.button&&1<e.length?
(this.options.views.remember&&c.cookie&&(b=c.cookie("plupload_ui_view")),~f.inArray(b,["list","thumbs"])||(b=this.options.views.active),d.show().buttonset().find(".ui-button").click(function(d){b=c(this).data("view");a._viewChanged(b);d.preventDefault()}),e=d.find('[for="'+a.id+"_view_"+b+'"]'),e.length&&e.trigger("click")):(d.show(),this._viewChanged(this.options.views.active));this.options.views.thumbs&&this._displayThumbs()},_enableRenaming:function(){var a=this;this.filelist.dblclick(function(b){var d=
c(b.target),e,f,g="";if(d.hasClass("plupload_file_name_wrapper")){f=a.uploader.getFile(d.closest(".plupload_file")[0].id);b=f.name;if(e=/^(.+)(\.[^.]+)$/.exec(b))b=e[1],g=e[2];e=c('<input class="plupload_file_rename" type="text" />').width(d.width()).insertAfter(d.hide());e.val(b).blur(function(){d.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(a){var b=c(this);-1!==c.inArray(a.keyCode,[13,27])&&(a.preventDefault(),13===a.keyCode&&(f.name=b.val()+g,d.html(f.name)),b.blur())})[0].focus()}})},
_enableSortingList:function(){var a=this;2>c(".plupload_file",this.filelist).length||(c("tbody",this.filelist).sortable("destroy"),this.filelist.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(){var b=[];c.each(c(this).sortable("toArray"),function(c,e){b[b.length]=a.uploader.getFile(e)});b.unshift(b.length);b.unshift(0);Array.prototype.splice.apply(a.uploader.files,b)}}))}})})(window,document,plupload,mOxie,jQuery);
